<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.4">
    <meta name="project" content="Lightning v2.15.0-pre3">


    <title>Lightning.ApolloClient â€” Lightning v2.15.0-pre3</title>

    <link rel="stylesheet" href="dist/html-elixir-RLZO5U2C.css" />

    <script defer src="dist/sidebar_items-548152C6.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-Y223O6DN.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.15.0-pre3
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Lightning.ApolloClient</span> 
      <small class="app-vsn" translate="no">(Lightning v2.15.0-pre3)</small>

    </h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>HTTP client for communicating with the Apollo AI service.</p><p>This module provides a Tesla-based HTTP client for interacting with Apollo,
an external AI service that powers Lightning's intelligent assistance features.
Apollo offers two main AI services:</p><ol><li><strong>Job Chat</strong> - Provides AI assistance for coding tasks, debugging, and
adaptor-specific guidance within individual workflow jobs</li><li><strong>Workflow Chat</strong> - Generates complete workflow templates from natural
language descriptions</li></ol><h2 id="module-configuration" class="section-heading"><a href="#module-configuration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Configuration</span></h2><p>The Apollo client requires the following configuration values:</p><ul><li><code class="inline">:endpoint</code> - Base URL of the Apollo service</li><li><code class="inline">:ai_assistant_api_key</code> - Authentication key for API access</li></ul>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:context/0" data-no-tooltip="" translate="no">context()</a>

      </div>

        <div class="summary-synopsis"><p>Context information for job-specific AI assistance.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:opts/0" data-no-tooltip="" translate="no">opts()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#job_chat/2" data-no-tooltip="" translate="no">job_chat(content, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Requests AI assistance for job-specific coding tasks and debugging.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#test/0" data-no-tooltip="" translate="no">test()</a>

      </div>

        <div class="summary-synopsis"><p>Performs a health check on the Apollo service endpoint.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#workflow_chat/2" data-no-tooltip="" translate="no">workflow_chat(content, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Generates or improves workflow templates using AI assistance.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>

    <div class="types-list">
<section class="detail" id="t:context/0">

  <div class="detail-header">
    <a href="#t:context/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">context()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L27" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> context() :: %{expression: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), adaptor: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()} | %{}</pre>

      </div>

<p>Context information for job-specific AI assistance.</p><p>Contains the job's expression code and adaptor information to help the AI
provide more targeted and relevant assistance.</p>
  </section>
</section>
<section class="detail" id="t:opts/0">

  <div class="detail-header">
    <a href="#t:opts/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">opts()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L34" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> opts() :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">keyword</a>()</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>

    <div class="functions-list">
<section class="detail" id="job_chat/2">

    <span id="job_chat/1"></span>

  <div class="detail-header">
    <a href="#job_chat/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">job_chat(content, opts \\ [])</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L81" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> job_chat(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="#t:opts/0">opts</a>()) :: <a href="https://hexdocs.pm/tesla/1.13.2/Tesla.Env.html#t:result/0">Tesla.Env.result</a>()</pre>

      </div>

<p>Requests AI assistance for job-specific coding tasks and debugging.</p><p>Sends user queries along with job context (expression code and adaptor) to the
Apollo job_chat service. The AI provides targeted assistance for coding tasks,
error debugging, adaptor-specific guidance, and best practices.</p><h2 id="job_chat/2-parameters" class="section-heading"><a href="#job_chat/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">content</code> - User's question or request for assistance</li><li><code class="inline">opts</code> - Keyword list of options:<ul><li><code class="inline">:context</code> - Job context including expression code and adaptor info (default: %{})</li><li><code class="inline">:history</code> - Previous conversation messages for context (default: [])</li><li><code class="inline">:meta</code> - Additional metadata like session IDs or user preferences (default: %{})</li></ul></li></ul><h2 id="job_chat/2-returns" class="section-heading"><a href="#job_chat/2-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><p><code class="inline">Tesla.Env.result()</code> with response body containing:</p><ul><li><code class="inline">&quot;history&quot;</code> - Updated conversation including AI response</li><li><code class="inline">&quot;usage&quot;</code> - Token usage and cost information</li><li><code class="inline">&quot;meta&quot;</code> - Updated metadata</li></ul>
  </section>
</section>
<section class="detail" id="test/0">

  <div class="detail-header">
    <a href="#test/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">test()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L49" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> test() :: :ok | :error</pre>

      </div>

<p>Performs a health check on the Apollo service endpoint.</p><p>Sends a GET request to the root endpoint to verify the service is running
and accessible. This should be called before attempting AI operations to
ensure graceful degradation when the service is unavailable.</p><h2 id="test/0-returns" class="section-heading"><a href="#test/0-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li><code class="inline">:ok</code> - Service responded with 2xx status code</li><li><code class="inline">:error</code> - Service unavailable, network error, or non-2xx response</li></ul>
  </section>
</section>
<section class="detail" id="workflow_chat/2">

    <span id="workflow_chat/1"></span>

  <div class="detail-header">
    <a href="#workflow_chat/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">workflow_chat(content, opts \\ [])</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L122" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> workflow_chat(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="#t:opts/0">opts</a>()) :: <a href="https://hexdocs.pm/tesla/1.13.2/Tesla.Env.html#t:result/0">Tesla.Env.result</a>()</pre>

      </div>

<p>Generates or improves workflow templates using AI assistance.</p><p>Sends requests to the Apollo workflow_chat service to create complete workflow
YAML definitions from natural language descriptions. Can also iteratively improve
existing workflows based on validation errors or user feedback.</p><h2 id="workflow_chat/2-parameters" class="section-heading"><a href="#workflow_chat/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">content</code> - Natural language description of desired workflow functionality</li><li><code class="inline">opts</code> - Keyword list of options:<ul><li><code class="inline">:code</code> - Optional existing workflow YAML to modify or improve</li><li><code class="inline">:errors</code> - Optional validation errors from previous workflow attempts</li><li><code class="inline">:history</code> - Previous conversation messages for context (default: [])</li><li><code class="inline">:meta</code> - Additional metadata (default: %{})</li></ul></li></ul><h2 id="workflow_chat/2-returns" class="section-heading"><a href="#workflow_chat/2-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><p><code class="inline">Tesla.Env.result()</code> with response body containing:</p><ul><li><code class="inline">&quot;response&quot;</code> - Human-readable explanation of the generated workflow</li><li><code class="inline">&quot;response_yaml&quot;</code> - Complete workflow YAML definition</li><li><code class="inline">&quot;usage&quot;</code> - Token usage and cost information</li></ul>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.4) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
