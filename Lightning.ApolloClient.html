<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="Lightning v2.13.5">


    <title>Lightning.ApolloClient â€” Lightning v2.13.5</title>

    <link rel="stylesheet" href="dist/html-elixir-J3PIVQVA.css" />

    <script defer src="dist/sidebar_items-701406CB.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.13.5
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Lightning.ApolloClient</span> 
      <small class="app-vsn" translate="no">(Lightning v2.13.5)</small>

    </h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>HTTP client for communicating with the Apollo AI service.</p><p>This module provides a Tesla-based HTTP client for interacting with Apollo,
an external AI service that powers Lightning's intelligent assistance features.
Apollo offers two main AI services:</p><ol><li><strong>Job Chat</strong> - Provides AI assistance for coding tasks, debugging, and
adaptor-specific guidance within individual workflow jobs</li><li><strong>Workflow Chat</strong> - Generates complete workflow templates from natural
language descriptions</li></ol><h2 id="module-configuration" class="section-heading"><a href="#module-configuration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Configuration</span></h2><p>The Apollo client requires the following configuration values:</p><ul><li><code class="inline">:endpoint</code> - Base URL of the Apollo service</li><li><code class="inline">:ai_assistant_api_key</code> - Authentication key for API access</li></ul><h2 id="module-usage-examples" class="section-heading"><a href="#module-usage-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Usage Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Check service availability</span><span class="w">
</span><span class="k">case</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">test</span><span class="p" data-group-id="7243279388-1">(</span><span class="p" data-group-id="7243279388-1">)</span><span class="w"> </span><span class="k" data-group-id="7243279388-2">do</span><span class="w">
  </span><span class="ss">:ok</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Service is healthy</span><span class="w">
  </span><span class="ss">:error</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Service unavailable</span><span class="w">
</span><span class="k" data-group-id="7243279388-2">end</span><span class="w">

</span><span class="c1"># Get job assistance</span><span class="w">
</span><span class="p" data-group-id="7243279388-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="7243279388-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">job_chat</span><span class="p" data-group-id="7243279388-4">(</span><span class="w">
  </span><span class="s">&quot;How do I handle API rate limits?&quot;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7243279388-5">%{</span><span class="ss">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fn() =&gt; http.get(&#39;/api/data&#39;)&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">adaptor</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@openfn/language-http&quot;</span><span class="p" data-group-id="7243279388-5">}</span><span class="p">,</span><span class="w">
  </span><span class="n">previous_messages</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7243279388-6">%{</span><span class="ss">session_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p" data-group-id="7243279388-6">}</span><span class="w">
</span><span class="p" data-group-id="7243279388-4">)</span><span class="w">

</span><span class="c1"># Generate workflow template</span><span class="w">
</span><span class="p" data-group-id="7243279388-7">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="7243279388-7">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">workflow_chat</span><span class="p" data-group-id="7243279388-8">(</span><span class="w">
  </span><span class="s">&quot;Create a daily sync from Salesforce to PostgreSQL&quot;</span><span class="p">,</span><span class="w">
  </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7243279388-9">[</span><span class="p" data-group-id="7243279388-9">]</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="7243279388-10">%{</span><span class="p" data-group-id="7243279388-10">}</span><span class="w">
</span><span class="p" data-group-id="7243279388-8">)</span></code></pre>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:context/0" data-no-tooltip="" translate="no">context()</a>

      </div>

        <div class="summary-synopsis"><p>Context information for job-specific AI assistance.</p></div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#job_chat/4" data-no-tooltip="" translate="no">job_chat(content, context \\ %{}, history \\ [], meta \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Requests AI assistance for job-specific coding tasks and debugging.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#query/4" data-no-tooltip="" translate="no">query(content, context \\ %{}, history \\ [], meta \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Legacy alias for <a><code class="inline">job_chat/4</code></a> maintained for backward compatibility.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#test/0" data-no-tooltip="" translate="no">test()</a>

      </div>

        <div class="summary-synopsis"><p>Performs a health check on the Apollo service endpoint.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#workflow_chat/5" data-no-tooltip="" translate="no">workflow_chat(content, existing_yaml \\ nil, errors \\ nil, history \\ [], meta \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Generates or improves workflow templates using AI assistance.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:context/0">

  <div class="detail-header">
    <a href="#t:context/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">context()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L52" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> context() :: %{expression: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), adaptor: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()} | %{}</pre>

      </div>

<p>Context information for job-specific AI assistance.</p><p>Contains the job's expression code and adaptor information to help the AI
provide more targeted and relevant assistance.</p>
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="job_chat/4">

    <span id="job_chat/1"></span>

    <span id="job_chat/2"></span>

    <span id="job_chat/3"></span>

  <div class="detail-header">
    <a href="#job_chat/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">job_chat(content, context \\ %{}, history \\ [], meta \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L137" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> job_chat(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="#t:context/0">context</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">list</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) :: <a href="https://hexdocs.pm/tesla/1.13.2/Tesla.Env.html#t:result/0">Tesla.Env.result</a>()</pre>

      </div>

<p>Requests AI assistance for job-specific coding tasks and debugging.</p><p>Sends user queries along with job context (expression code and adaptor) to the
Apollo job_chat service. The AI provides targeted assistance for coding tasks,
error debugging, adaptor-specific guidance, and best practices.</p><h2 id="job_chat/4-parameters" class="section-heading"><a href="#job_chat/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">content</code> - User's question or request for assistance</li><li><code class="inline">context</code> - Job context including expression code and adaptor info</li><li><code class="inline">history</code> - Previous conversation messages for context (list of maps with <code class="inline">:role</code> and <code class="inline">:content</code>)</li><li><code class="inline">meta</code> - Additional metadata like session IDs or user preferences</li></ul><h2 id="job_chat/4-returns" class="section-heading"><a href="#job_chat/4-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><p><code class="inline">Tesla.Env.result()</code> with response body containing:</p><ul><li><code class="inline">&quot;history&quot;</code> - Updated conversation including AI response</li><li><code class="inline">&quot;usage&quot;</code> - Token usage and cost information</li><li><code class="inline">&quot;meta&quot;</code> - Updated metadata</li></ul><h2 id="job_chat/4-examples" class="section-heading"><a href="#job_chat/4-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Basic job assistance</span><span class="w">
</span><span class="p" data-group-id="6187581827-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6187581827-2">%{</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6187581827-3">%{</span><span class="s">&quot;history&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">updated_history</span><span class="p" data-group-id="6187581827-3">}</span><span class="p" data-group-id="6187581827-2">}</span><span class="p" data-group-id="6187581827-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">job_chat</span><span class="p" data-group-id="6187581827-4">(</span><span class="w">
  </span><span class="s">&quot;Why is my HTTP request returning a 401 error?&quot;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6187581827-5">%{</span><span class="w">
    </span><span class="ss">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fn(state) =&gt; http.get(&#39;https://api.example.com/data&#39;, {headers: {&#39;Authorization&#39;: &#39;Bearer &#39; + state.token}})&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">adaptor</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@openfn/language-http&quot;</span><span class="w">
  </span><span class="p" data-group-id="6187581827-5">}</span><span class="w">
</span><span class="p" data-group-id="6187581827-4">)</span><span class="w">

</span><span class="c1"># With conversation history</span><span class="w">
</span><span class="p" data-group-id="6187581827-6">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="6187581827-6">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">job_chat</span><span class="p" data-group-id="6187581827-7">(</span><span class="w">
  </span><span class="s">&quot;Can you show me how to add error handling?&quot;</span><span class="p">,</span><span class="w">
  </span><span class="n">job_context</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6187581827-8">[</span><span class="w">
    </span><span class="p" data-group-id="6187581827-9">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;How do I make an HTTP request?&quot;</span><span class="p" data-group-id="6187581827-9">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6187581827-10">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;assistant&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Here&#39;s how to make HTTP requests...&quot;</span><span class="p" data-group-id="6187581827-10">}</span><span class="w">
  </span><span class="p" data-group-id="6187581827-8">]</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6187581827-11">%{</span><span class="ss">session_id</span><span class="p">:</span><span class="w"> </span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="6187581827-11">}</span><span class="w">
</span><span class="p" data-group-id="6187581827-7">)</span></code></pre>
  </section>
</section>
<section class="detail" id="query/4">

    <span id="query/1"></span>

    <span id="query/2"></span>

    <span id="query/3"></span>

  <div class="detail-header">
    <a href="#query/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">query(content, context \\ %{}, history \\ [], meta \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L171" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> query(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="#t:context/0">context</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">list</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) :: <a href="https://hexdocs.pm/tesla/1.13.2/Tesla.Env.html#t:result/0">Tesla.Env.result</a>()</pre>

      </div>

<p>Legacy alias for <a href="#job_chat/4"><code class="inline">job_chat/4</code></a> maintained for backward compatibility.</p><h2 id="query/4-deprecated" class="section-heading"><a href="#query/4-deprecated" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Deprecated</span></h2><p>Use <a href="#job_chat/4"><code class="inline">job_chat/4</code></a> instead. This function will be removed in a future version.</p><h2 id="query/4-parameters" class="section-heading"><a href="#query/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><p>Same as <a href="#job_chat/4"><code class="inline">job_chat/4</code></a>.</p><h2 id="query/4-examples" class="section-heading"><a href="#query/4-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Old way (deprecated)</span><span class="w">
</span><span class="p" data-group-id="9170487671-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="9170487671-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">query</span><span class="p" data-group-id="9170487671-2">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">history</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="p" data-group-id="9170487671-2">)</span><span class="w">

</span><span class="c1"># New way (preferred)</span><span class="w">
</span><span class="p" data-group-id="9170487671-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="9170487671-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">job_chat</span><span class="p" data-group-id="9170487671-4">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">history</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="p" data-group-id="9170487671-4">)</span></code></pre>
  </section>
</section>
<section class="detail" id="test/0">

  <div class="detail-header">
    <a href="#test/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">test()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L84" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> test() :: :ok | :error</pre>

      </div>

<p>Performs a health check on the Apollo service endpoint.</p><p>Sends a GET request to the root endpoint to verify the service is running
and accessible. This should be called before attempting AI operations to
ensure graceful degradation when the service is unavailable.</p><h2 id="test/0-returns" class="section-heading"><a href="#test/0-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li><code class="inline">:ok</code> - Service responded with 2xx status code</li><li><code class="inline">:error</code> - Service unavailable, network error, or non-2xx response</li></ul><h2 id="test/0-examples" class="section-heading"><a href="#test/0-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="k">case</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">test</span><span class="p" data-group-id="5002114706-1">(</span><span class="p" data-group-id="5002114706-1">)</span><span class="w"> </span><span class="k" data-group-id="5002114706-2">do</span><span class="w">
  </span><span class="ss">:ok</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="c1"># Service is healthy, proceed with AI operations</span><span class="w">
    </span><span class="n">show_ai_features</span><span class="p" data-group-id="5002114706-3">(</span><span class="p" data-group-id="5002114706-3">)</span><span class="w">
  </span><span class="ss">:error</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="c1"># Service unavailable, disable AI features</span><span class="w">
    </span><span class="n">hide_ai_features</span><span class="p" data-group-id="5002114706-4">(</span><span class="p" data-group-id="5002114706-4">)</span><span class="w">
</span><span class="k" data-group-id="5002114706-2">end</span></code></pre>
  </section>
</section>
<section class="detail" id="workflow_chat/5">

    <span id="workflow_chat/1"></span>

    <span id="workflow_chat/2"></span>

    <span id="workflow_chat/3"></span>

    <span id="workflow_chat/4"></span>

  <div class="detail-header">
    <a href="#workflow_chat/5" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">workflow_chat(content, existing_yaml \\ nil, errors \\ nil, history \\ [], meta \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/apollo_client.ex#L233" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> workflow_chat(
  <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil,
  <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil,
  <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">list</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()
) :: <a href="https://hexdocs.pm/tesla/1.13.2/Tesla.Env.html#t:result/0">Tesla.Env.result</a>()</pre>

      </div>

<p>Generates or improves workflow templates using AI assistance.</p><p>Sends requests to the Apollo workflow_chat service to create complete workflow
YAML definitions from natural language descriptions. Can also iteratively improve
existing workflows based on validation errors or user feedback.</p><h2 id="workflow_chat/5-parameters" class="section-heading"><a href="#workflow_chat/5-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">content</code> - Natural language description of desired workflow functionality</li><li><code class="inline">existing_yaml</code> - Optional existing workflow YAML to modify or improve</li><li><code class="inline">errors</code> - Optional validation errors from previous workflow attempts</li><li><code class="inline">history</code> - Previous conversation messages for context</li><li><code class="inline">meta</code> - Additional metadata</li></ul><h2 id="workflow_chat/5-returns" class="section-heading"><a href="#workflow_chat/5-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><p><code class="inline">Tesla.Env.result()</code> with response body containing:</p><ul><li><code class="inline">&quot;response&quot;</code> - Human-readable explanation of the generated workflow</li><li><code class="inline">&quot;response_yaml&quot;</code> - Complete workflow YAML definition</li><li><code class="inline">&quot;usage&quot;</code> - Token usage and cost information</li></ul><h2 id="workflow_chat/5-examples" class="section-heading"><a href="#workflow_chat/5-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Generate new workflow from description</span><span class="w">
</span><span class="p" data-group-id="3249912668-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3249912668-2">%{</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3249912668-3">%{</span><span class="s">&quot;response_yaml&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">yaml</span><span class="p" data-group-id="3249912668-3">}</span><span class="p" data-group-id="3249912668-2">}</span><span class="p" data-group-id="3249912668-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">workflow_chat</span><span class="p" data-group-id="3249912668-4">(</span><span class="w">
  </span><span class="s">&quot;Create a daily workflow that syncs Salesforce contacts to a PostgreSQL database&quot;</span><span class="w">
</span><span class="p" data-group-id="3249912668-4">)</span><span class="w">

</span><span class="c1"># Improve existing workflow</span><span class="w">
</span><span class="p" data-group-id="3249912668-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="3249912668-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">workflow_chat</span><span class="p" data-group-id="3249912668-6">(</span><span class="w">
  </span><span class="s">&quot;Add error handling and logging to this workflow&quot;</span><span class="p">,</span><span class="w">
  </span><span class="n">existing_workflow_yaml</span><span class="w">
</span><span class="p" data-group-id="3249912668-6">)</span><span class="w">

</span><span class="c1"># Fix validation errors</span><span class="w">
</span><span class="p" data-group-id="3249912668-7">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="3249912668-7">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">workflow_chat</span><span class="p" data-group-id="3249912668-8">(</span><span class="w">
  </span><span class="s">&quot;Please fix the validation errors in this workflow&quot;</span><span class="p">,</span><span class="w">
  </span><span class="n">broken_yaml</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;Invalid cron expression: &#39;0 0 * * 8&#39;. Day of week must be 0-6.&quot;</span><span class="w">
</span><span class="p" data-group-id="3249912668-8">)</span><span class="w">

</span><span class="c1"># With conversation context</span><span class="w">
</span><span class="p" data-group-id="3249912668-9">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="3249912668-9">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApolloClient</span><span class="o">.</span><span class="n">workflow_chat</span><span class="p" data-group-id="3249912668-10">(</span><span class="w">
  </span><span class="s">&quot;Make the sync run every 2 hours instead of daily&quot;</span><span class="p">,</span><span class="w">
  </span><span class="n">current_yaml</span><span class="p">,</span><span class="w">
  </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="n">previous_conversation</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3249912668-11">%{</span><span class="ss">project_id</span><span class="p">:</span><span class="w"> </span><span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="3249912668-11">}</span><span class="w">
</span><span class="p" data-group-id="3249912668-10">)</span></code></pre>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
