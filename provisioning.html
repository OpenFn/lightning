<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="Lightning v2.10.15">


    <title>Provisioning — Lightning v2.10.15</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-7C26FD45.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/Lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/Lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.10.15
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/PROVISIONING.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Provisioning</span>
  </h1>

<p>Lightning offers the ability to configure projects via the HTTP API.</p><p>By providing a JSON document with the desired configuration, the project can be
configured to your liking.</p><h2 id="using-the-api" class="section-heading">
  <a href="#using-the-api" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using the API</span>
</h2>
<p>The API is available at <code class="inline">/api/provision</code>, and expects an <code class="inline">application/json</code>
Content-Type.</p><h3 id="authentication" class="section-heading">
  <a href="#authentication" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Authentication</span>
</h3>
<p>The API requires a valid auth token to be provided in the <code class="inline">Authorization</code>
header.</p><h3 id="example-request" class="section-heading">
  <a href="#example-request" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example Request</span>
</h3>
<pre><code class="makeup bash" translate="no"><span class=""> curl -X POST \
</span><span class="">   -d @project.json \
</span><span class="">   -H &quot;Authorization: Bearer $TOKEN&quot; \
</span><span class="">   -H &quot;Content-Type: application/json&quot; \
</span><span class="">   $ENDPOINT/api/provision
</span></code></pre><h2 id="document-structure" class="section-heading">
  <a href="#document-structure" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Document Structure</span>
</h2>
<p>The provisioning document is a JSON document with the project at the root.</p><blockquote><p>All entities <strong>must have</strong> an <code class="inline">id</code> field, which is a UUIDv4 string. In the
case of new entities, this must be generated by the client.</p></blockquote><pre><code class="jsonc">{
  &quot;id&quot;: &quot;&lt;&lt;project-id&gt;&gt;&quot;,
  &quot;name&quot;: &quot;&lt;&lt;project-name&gt;&gt;&quot;,
  &quot;workflows&quot;: [
    {
      &quot;id&quot;: &quot;&lt;&lt;workflow-id&gt;&gt;&quot;,
      &quot;name&quot;: &quot;&lt;&lt;workflow-name&gt;&gt;&quot;,
      &quot;jobs&quot;: [
        {
          &quot;id&quot;: &quot;&lt;&lt;job-id&gt;&gt;&quot;,
          &quot;name&quot;: &quot;&lt;&lt;job-name&gt;&gt;&quot;,
          &quot;body&quot;: &quot;&lt;&lt;job-body&gt;&gt;&quot;,
          &quot;adaptor&quot;: &quot;&lt;&lt;adaptor-name&gt;&gt;&quot;,
          &quot;enabled&quot;: true
        }
        // ... more jobs
      ],
      &quot;triggers&quot;: [
        {
          &quot;id&quot;: &quot;&lt;&lt;trigger-id&gt;&gt;&quot;,
          &quot;name&quot;: &quot;&lt;&lt;trigger-name&gt;&gt;&quot;,
          &quot;type&quot;: &quot;webhook&quot;
        }
        // ... more triggers
      ],
      &quot;edges&quot;: [
        {
          &quot;id&quot;: &quot;&lt;&lt;edge-id&gt;&gt;&quot;,
          &quot;source_trigger_id&quot;: &quot;&lt;&lt;trigger-id&gt;&gt;&quot;,
          &quot;target_job_id&quot;: &quot;&lt;&lt;job-id&gt;&gt;&quot;
        }
        // ... more edges
      ]
    }
    // ... more workflows
  ]
}</code></pre><h2 id="api-behaviour" class="section-heading">
  <a href="#api-behaviour" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">API Behaviour</span>
</h2>
<p>The API expects <strong>all</strong> existing entities to be provided in the provisioning
document.</p><p>If the document provided is out of date (e.g. a new job was added on the
server), a new reference document should be fetched and the changes applied to
it.</p><h3 id="deleting-entities" class="section-heading">
  <a href="#deleting-entities" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Deleting Entities</span>
</h3>
<p>Entities can be deleted by setting the <code class="inline">delete</code> key to <code class="inline">true</code>.</p><p>Example:</p><pre><code class="jsonc">{
  &quot;id&quot;: &quot;&lt;&lt;project-id&gt;&gt;&quot;,
  &quot;workflows&quot;: [
    {
      &quot;id&quot;: &quot;&lt;&lt;workflow-id&gt;&gt;&quot;,
      &quot;jobs&quot;: [
        {
          &quot;id&quot;: &quot;&lt;&lt;job-id&gt;&gt;&quot;,
          &quot;delete&quot;: true // &lt;== delete this job
        }
      ]
    }
  ]
}</code></pre><h2 id="relationship-with-projects-as-code" class="section-heading">
  <a href="#relationship-with-projects-as-code" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Relationship with Projects as Code</span>
</h2>
<p>The Projects as Code spec is a superset of the provisioning API.</p><p>Projects as Code allows for the user to specify a key for each entity, which
makes it easier to manage the project in the future.</p><p>For example:</p><pre><code class="yaml">name: my-project
workflows:
  workflow-one:
    jobs:
      job-one:
        body: |
          console.log(&quot;Hello World&quot;);
        adaptor: '@openfn/language-common'
        enabled: true
    triggers:
      trigger-one:
        type: webhook
    edges:
      - source_trigger: trigger-one
        target_job: job-one</code></pre><p>The above YAML document illustrates the use of keys being used to identify
entities. Allowing the user to provision the same project to multiple
environments.</p><p>The API is unaware of 'keys', and expects IDs to be provided by the client.</p><p>In order to convert the above YAML document to a provisioning document, the CLI
uses a local state file (if available) to map the keys to UUIDs.</p><p>Using the example above a state file might look like this:</p><pre><code class="jsonc">{
  &quot;id&quot;: &quot;f6ba9a8c-b687-473a-908e-e250686f1eed&quot;,
  &quot;workflows&quot;: {
    &quot;workflow-one&quot;: {
      &quot;id&quot;: &quot;f206aa85-4fce-492e-94eb-ffd32c75d178&quot;,
      &quot;jobs&quot;: {},
      &quot;triggers&quot;: {}
    }
  }
}</code></pre><p>The state file shows that the project and workflow already exist, but the job,
trigger and edge do not. In order to create these new entities, IDs will be
applied them.</p><p>On a successful application of the provisioning document, the state file will be
updated to reflect the new IDs and entities.</p><pre><code class="json">{
  &quot;id&quot;: &quot;f6ba9a8c-b687-473a-908e-e250686f1eed&quot;,
  &quot;workflows&quot;: {
    &quot;workflow-one&quot;: {
      &quot;id&quot;: &quot;f206aa85-4fce-492e-94eb-ffd32c75d178&quot;,
      &quot;jobs&quot;: {
        &quot;job-one&quot;: { &quot;id&quot;: &quot;18ed71de-caf8-4822-aefc-5b19351f4016&quot; }
      },
      &quot;triggers&quot;: {
        &quot;trigger-one&quot;: { &quot;id&quot;: &quot;e0b9f357-9cf9-4206-9924-4d5674aad830&quot; }
      },
      &quot;edges&quot;: [
        {
          &quot;id&quot;: &quot;c239d994-6662-4637-90f8-0293c924b461&quot;,
          &quot;source_trigger_id&quot;: &quot;e0b9f357-9cf9-4206-9924-4d5674aad830&quot;,
          &quot;target_job_id&quot;: &quot;18ed71de-caf8-4822-aefc-5b19351f4016&quot;
        }
      ]
    }
  }
}</code></pre>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="workers.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Workers
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="changelog.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Changelog
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
