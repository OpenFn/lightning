<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.1">
    <meta name="project" content="Lightning v2.13.2">


    <title>Lightning.AiAssistant.ChatSession â€” Lightning v2.13.2</title>

    <link rel="stylesheet" href="dist/html-elixir-J3PIVQVA.css" />

    <script defer src="dist/sidebar_items-67443C59.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.13.2
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Lightning.AiAssistant.ChatSession</span> 
      <small class="app-vsn" translate="no">(Lightning v2.13.2)</small>

    </h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/ai_assistant/chat_session.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Represents a chat session for AI assistance, including job code and workflow templates.</p><p>This module defines the schema and changeset for chat sessions, including
relationships to users, jobs, projects, and workflows. It also includes custom
validation logic to ensure that the correct fields are populated based on the session type.</p><h2 id="module-session-types" class="section-heading"><a href="#module-session-types" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Session Types</span></h2><ul><li><code class="inline">&quot;job_code&quot;</code> - Sessions focused on generating or modifying code for specific jobs</li><li><code class="inline">&quot;workflow_template&quot;</code> - Sessions for creating workflow templates within a project</li></ul><h2 id="module-schema-fields" class="section-heading"><a href="#module-schema-fields" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Schema Fields</span></h2><h3 id="module-core-fields" class="section-heading"><a href="#module-core-fields" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Core Fields</span></h3><ul><li><code class="inline">title</code> - Human-readable title for the session (required)</li><li><code class="inline">session_type</code> - Type of session, defaults to &quot;job_code&quot;</li><li><code class="inline">meta</code> - Additional metadata stored as a map</li><li><code class="inline">is_public</code> - Whether the session is publicly visible (defaults to false)</li><li><code class="inline">is_deleted</code> - Soft deletion flag (defaults to false)</li></ul><h3 id="module-associations" class="section-heading"><a href="#module-associations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Associations</span></h3><ul><li><code class="inline">user_id</code> - The user who owns this session (required)</li><li><code class="inline">job_id</code> - Associated job (required for &quot;job_code&quot; sessions)</li><li><code class="inline">project_id</code> - Associated project (required for &quot;workflow_template&quot; sessions)</li><li><code class="inline">workflow_id</code> - Associated workflow (optional)</li></ul><h3 id="module-virtual-fields-runtime-only" class="section-heading"><a href="#module-virtual-fields-runtime-only" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Virtual Fields (Runtime Only)</span></h3><ul><li><code class="inline">expression</code> - Current job expression for context</li><li><code class="inline">adaptor</code> - Current job adaptor for context</li><li><code class="inline">message_count</code> - Number of messages in the session</li></ul><h2 id="module-validation-rules" class="section-heading"><a href="#module-validation-rules" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Validation Rules</span></h2><h3 id="module-session-type-requirements" class="section-heading"><a href="#module-session-type-requirements" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Session Type Requirements</span></h3><ul><li><strong>job_code sessions</strong>: Must have a <code class="inline">job_id</code></li><li><strong>workflow_template sessions</strong>: Must have a <code class="inline">project_id</code></li></ul>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:t/0" data-no-tooltip="" translate="no">t()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changeset/2" data-no-tooltip="" translate="no">changeset(chat_session, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a changeset for a chat session.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:t/0">

  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">t()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/ai_assistant/chat_session.ex#L52" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> t() :: %Lightning.AiAssistant.ChatSession{
  __meta__: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  adaptor: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil,
  expression: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil,
  id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>(),
  inserted_at: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  is_deleted: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>(),
  is_public: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>(),
  job: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  job_id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>() | nil,
  message_count: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>() | nil,
  messages: [<a href="Lightning.AiAssistant.ChatMessage.html#t:t/0">Lightning.AiAssistant.ChatMessage.t</a>()] | [],
  meta: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | nil,
  project: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  project_id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>() | nil,
  session_type: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  title: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  updated_at: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  user: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  user_id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>(),
  workflow: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  workflow_id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>() | nil
}</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="changeset/2">

  <div class="detail-header">
    <a href="#changeset/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">changeset(chat_session, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/ai_assistant/chat_session.ex#L142" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Creates a changeset for a chat session.</p><h2 id="changeset/2-parameters" class="section-heading"><a href="#changeset/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">chat_session</code> - The ChatSession struct to update (typically <code class="inline">%ChatSession{}</code>)</li><li><code class="inline">attrs</code> - Map of attributes to set/update</li></ul><h2 id="changeset/2-validation-rules" class="section-heading"><a href="#changeset/2-validation-rules" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Validation Rules</span></h2><ul><li><code class="inline">title</code> and <code class="inline">user_id</code> are required</li><li><code class="inline">session_type</code> must be one of: # {inspect(@valid_session_types)}</li><li><strong>job_code sessions</strong> require <code class="inline">job_id</code></li><li><strong>workflow_template sessions</strong> require <code class="inline">project_id</code></li><li>Associated messages are cast and validated</li></ul><h2 id="changeset/2-examples" class="section-heading"><a href="#changeset/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Valid job code session</span><span class="w">
</span><span class="nc">ChatSession</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3859197957-1">(</span><span class="p" data-group-id="3859197957-2">%</span><span class="nc" data-group-id="3859197957-2">ChatSession</span><span class="p" data-group-id="3859197957-2">{</span><span class="p" data-group-id="3859197957-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3859197957-3">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Fix data transformation&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">session_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;job_code&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="ss">job_id</span><span class="p">:</span><span class="w"> </span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="w">
</span><span class="p" data-group-id="3859197957-3">}</span><span class="p" data-group-id="3859197957-1">)</span><span class="w">

</span><span class="c1"># Valid workflow template session</span><span class="w">
</span><span class="nc">ChatSession</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3859197957-4">(</span><span class="p" data-group-id="3859197957-5">%</span><span class="nc" data-group-id="3859197957-5">ChatSession</span><span class="p" data-group-id="3859197957-5">{</span><span class="p" data-group-id="3859197957-5">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3859197957-6">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Customer onboarding flow&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">session_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;workflow_template&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="ss">project_id</span><span class="p">:</span><span class="w"> </span><span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="ss">is_public</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
</span><span class="p" data-group-id="3859197957-6">}</span><span class="p" data-group-id="3859197957-4">)</span><span class="w">

</span><span class="c1"># With nested messages</span><span class="w">
</span><span class="nc">ChatSession</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3859197957-7">(</span><span class="p" data-group-id="3859197957-8">%</span><span class="nc" data-group-id="3859197957-8">ChatSession</span><span class="p" data-group-id="3859197957-8">{</span><span class="p" data-group-id="3859197957-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3859197957-9">%{</span><span class="w">
  </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Debug session&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="ss">job_id</span><span class="p">:</span><span class="w"> </span><span class="n">job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="ss">messages</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3859197957-10">[</span><span class="w">
    </span><span class="p" data-group-id="3859197957-11">%{</span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Help me fix this error&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="3859197957-11">}</span><span class="w">
  </span><span class="p" data-group-id="3859197957-10">]</span><span class="w">
</span><span class="p" data-group-id="3859197957-9">}</span><span class="p" data-group-id="3859197957-7">)</span></code></pre><h2 id="changeset/2-errors" class="section-heading"><a href="#changeset/2-errors" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Errors</span></h2><p>Returns a changeset with errors if:</p><ul><li>Required fields are missing</li><li>Invalid session_type is provided</li><li>Session type requirements aren't met (e.g., job_code without job_id)</li></ul>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.1) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
