<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="Lightning v2.11.1">


    <title>Lightning.Credentials.OauthToken â€” Lightning v2.11.1</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-61109A19.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/Lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/Lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.11.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/credentials/oauth_token.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">Lightning.Credentials.OauthToken</span> 
    <small class="app-vsn" translate="no">(Lightning v2.11.1)</small>

  </h1>


    <section id="moduledoc">
<p>Schema and functions for managing OAuth tokens. This module handles the storage and
validation of OAuth tokens, allowing multiple credentials to share the same token
when they have identical scope sets.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:t/0" data-no-tooltip translate="no">t()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changeset/1" data-no-tooltip translate="no">changeset(attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a changeset for validating and creating an OAuth token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changeset/2" data-no-tooltip translate="no">changeset(oauth_token, attrs)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#extract_scopes/1" data-no-tooltip translate="no">extract_scopes(arg1)</a>

      </div>

        <div class="summary-synopsis"><p>Extracts scopes from OAuth token data in various formats.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_token_changeset/2" data-no-tooltip translate="no">update_token_changeset(oauth_token, new_token)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a changeset for updating token data.
Only merges with existing token body if new_token is a map, otherwise uses new_token directly.
Preserves the refresh_token from the existing token.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:t/0">

  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">t()</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/credentials/oauth_token.ex#L14" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> t() :: %Lightning.Credentials.OauthToken{
  __meta__: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  body: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>(),
  credentials: [<a href="Lightning.Credentials.Credential.html#t:t/0">Lightning.Credentials.Credential.t</a>()] | nil,
  id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>() | nil,
  inserted_at: <a href="https://hexdocs.pm/elixir/DateTime.html#t:t/0">DateTime.t</a>() | nil,
  oauth_client: <a href="Lightning.Credentials.OauthClient.html#t:t/0">Lightning.Credentials.OauthClient.t</a>() | nil,
  oauth_client_id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>() | nil,
  scopes: [<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()],
  updated_at: <a href="https://hexdocs.pm/elixir/DateTime.html#t:t/0">DateTime.t</a>() | nil,
  user: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>() | nil,
  user_id: <a href="https://hexdocs.pm/ecto/3.12.5/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>() | nil
}</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="changeset/1">

  <div class="detail-header">
    <a href="#changeset/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changeset(attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/credentials/oauth_token.ex#L65" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Creates a changeset for validating and creating an OAuth token.</p><h2 id="changeset/1-parameters" class="section-heading">
  <a href="#changeset/1-parameters" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parameters</span>
</h2>
<ul><li><code class="inline">attrs</code> - A map containing token attributes:<ul><li><code class="inline">:body</code> - The token data (required)</li><li><code class="inline">:scopes</code> - List of permission scopes for the token (required)</li><li><code class="inline">:oauth_client_id</code> - Reference to the OAuth client (required)</li><li><code class="inline">:user_id</code> - Reference to the user (required)</li></ul></li></ul><h2 id="changeset/1-validations" class="section-heading">
  <a href="#changeset/1-validations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Validations</span>
</h2>
<ul><li>All fields are required</li><li>Referenced oauth_client and user must exist</li><li>Token body must be valid (via validate_oauth_body/1)</li></ul><h2 id="changeset/1-examples" class="section-heading">
  <a href="#changeset/1-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">OauthToken</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="0347878269-1">(</span><span class="p" data-group-id="0347878269-2">%{</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0347878269-3">%{</span><span class="s">&quot;access_token&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;abc123&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;refresh_token&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;xyz789&quot;</span><span class="p" data-group-id="0347878269-3">}</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">scopes</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0347878269-4">[</span><span class="s">&quot;read&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;write&quot;</span><span class="p" data-group-id="0347878269-4">]</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">oauth_client_id</span><span class="p">:</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="p" data-group-id="0347878269-2">}</span><span class="p" data-group-id="0347878269-1">)</span><span class="w">
</span><span class="p" data-group-id="0347878269-5">#</span><span class="nc" data-group-id="0347878269-5">Ecto.Changeset</span><span class="p" data-group-id="0347878269-5">&lt;</span><span class="n">...</span><span class="p" data-group-id="0347878269-5">&gt;</span></code></pre>
  </section>
</section>
<section class="detail" id="changeset/2">

  <div class="detail-header">
    <a href="#changeset/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changeset(oauth_token, attrs)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/credentials/oauth_token.ex#L67" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="extract_scopes/1">

  <div class="detail-header">
    <a href="#extract_scopes/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">extract_scopes(arg1)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/credentials/oauth_token.ex#L138" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Extracts scopes from OAuth token data in various formats.</p><p>Handles four common OAuth scope formats:</p><ul><li>Maps with string &quot;scope&quot; key containing space-delimited scope strings</li><li>Maps with atom :scope key containing space-delimited scope strings</li><li>Maps with string &quot;scopes&quot; key containing a list of scope strings</li><li>Maps with atom :scopes key containing a list of scope strings</li></ul><h2 id="extract_scopes/1-return-values" class="section-heading">
  <a href="#extract_scopes/1-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values</span>
</h2>
<ul><li><code class="inline">{:ok, scopes}</code> - List of scope strings if extraction succeeds</li><li><code class="inline">:error</code> - If scopes cannot be determined from the input</li></ul><h2 id="extract_scopes/1-examples" class="section-heading">
  <a href="#extract_scopes/1-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">extract_scopes</span><span class="p" data-group-id="9310462208-1">(</span><span class="p" data-group-id="9310462208-2">%{</span><span class="s">&quot;scope&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;read write delete&quot;</span><span class="p" data-group-id="9310462208-2">}</span><span class="p" data-group-id="9310462208-1">)</span><span class="w">
</span><span class="p" data-group-id="9310462208-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9310462208-4">[</span><span class="s">&quot;read&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;write&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delete&quot;</span><span class="p" data-group-id="9310462208-4">]</span><span class="p" data-group-id="9310462208-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">extract_scopes</span><span class="p" data-group-id="9310462208-5">(</span><span class="p" data-group-id="9310462208-6">%{</span><span class="ss">scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;profile email&quot;</span><span class="p" data-group-id="9310462208-6">}</span><span class="p" data-group-id="9310462208-5">)</span><span class="w">
</span><span class="p" data-group-id="9310462208-7">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9310462208-8">[</span><span class="s">&quot;profile&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;email&quot;</span><span class="p" data-group-id="9310462208-8">]</span><span class="p" data-group-id="9310462208-7">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">extract_scopes</span><span class="p" data-group-id="9310462208-9">(</span><span class="p" data-group-id="9310462208-10">%{</span><span class="s">&quot;scopes&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9310462208-11">[</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p" data-group-id="9310462208-11">]</span><span class="p" data-group-id="9310462208-10">}</span><span class="p" data-group-id="9310462208-9">)</span><span class="w">
</span><span class="p" data-group-id="9310462208-12">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9310462208-13">[</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p" data-group-id="9310462208-13">]</span><span class="p" data-group-id="9310462208-12">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">extract_scopes</span><span class="p" data-group-id="9310462208-14">(</span><span class="p" data-group-id="9310462208-15">%{</span><span class="ss">scopes</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310462208-16">[</span><span class="s">&quot;read&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;write&quot;</span><span class="p" data-group-id="9310462208-16">]</span><span class="p" data-group-id="9310462208-15">}</span><span class="p" data-group-id="9310462208-14">)</span><span class="w">
</span><span class="p" data-group-id="9310462208-17">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9310462208-18">[</span><span class="s">&quot;read&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;write&quot;</span><span class="p" data-group-id="9310462208-18">]</span><span class="p" data-group-id="9310462208-17">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">extract_scopes</span><span class="p" data-group-id="9310462208-19">(</span><span class="p" data-group-id="9310462208-20">%{</span><span class="ss">other_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p" data-group-id="9310462208-20">}</span><span class="p" data-group-id="9310462208-19">)</span><span class="w">
</span><span class="ss">:error</span></code></pre>
  </section>
</section>
<section class="detail" id="update_token_changeset/2">

  <div class="detail-header">
    <a href="#update_token_changeset/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_token_changeset(oauth_token, new_token)</h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/credentials/oauth_token.ex#L81" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Creates a changeset for updating token data.
Only merges with existing token body if new_token is a map, otherwise uses new_token directly.
Preserves the refresh_token from the existing token.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
