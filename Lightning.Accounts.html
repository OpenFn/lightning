<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.4">
    <meta name="project" content="Lightning v2.15.10-pre">


    <title>Lightning.Accounts â€” Lightning v2.15.10-pre</title>

    <link rel="stylesheet" href="dist/html-elixir-RLZO5U2C.css" />

    <script defer src="dist/sidebar_items-BD46DD64.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-Y223O6DN.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.15.10-pre
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Lightning.Accounts</span> 
      <small class="app-vsn" translate="no">(Lightning v2.15.10-pre)</small>

    </h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>The Accounts context.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply_user_email/3" data-no-tooltip="" translate="no">apply_user_email(user, password, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Emulates that the email will change without actually changing
it in the database.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cancel_scheduled_deletion/1" data-no-tooltip="" translate="no">cancel_scheduled_deletion(user_id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_scheduled_deletion/2" data-no-tooltip="" translate="no">change_scheduled_deletion(user, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user scheduled_deletion.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_superuser_registration/1" data-no-tooltip="" translate="no">change_superuser_registration(attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking superuser changes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user/2" data-no-tooltip="" translate="no">change_user(user, attrs)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_email/2" data-no-tooltip="" translate="no">change_user_email(user, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user email.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_info/2" data-no-tooltip="" translate="no">change_user_info(user, attrs \\ %{})</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_password/2" data-no-tooltip="" translate="no">change_user_password(user, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_user_registration/1" data-no-tooltip="" translate="no">change_user_registration(attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking user changes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#confirm_user/1" data-no-tooltip="" translate="no">confirm_user(token)</a>

      </div>

        <div class="summary-synopsis"><p>Confirms a user by the given token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#confirmation_required?/1" data-no-tooltip="" translate="no">confirmation_required?(user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#create_user/1" data-no-tooltip="" translate="no">create_user(attrs)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_auth_token/1" data-no-tooltip="" translate="no">delete_auth_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the signed token with the given context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_session_token/1" data-no-tooltip="" translate="no">delete_session_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the signed token with the given context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_sudo_session_token/1" data-no-tooltip="" translate="no">delete_sudo_session_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the signed token with the given context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_token/1" data-no-tooltip="" translate="no">delete_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_user/1" data-no-tooltip="" translate="no">delete_user(user)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_user_totp/1" data-no-tooltip="" translate="no">delete_user_totp(totp)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the given user's TOTP</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_user_confirmation_instructions/1" data-no-tooltip="" translate="no">deliver_user_confirmation_instructions(user)</a>

      </div>

        <div class="summary-synopsis"><p>Delivers the confirmation email instructions to the given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_user_confirmation_instructions/2" data-no-tooltip="" translate="no">deliver_user_confirmation_instructions(registerer, user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deliver_user_reset_password_instructions/2" data-no-tooltip="" translate="no">deliver_user_reset_password_instructions(user, reset_password_url_fun)</a>

      </div>

        <div class="summary-synopsis"><p>Delivers the reset password email to the given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#exchange_auth_token/1" data-no-tooltip="" translate="no">exchange_auth_token(auth_token)</a>

      </div>

        <div class="summary-synopsis"><p>Exchanges an auth token for a session token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#experimental_features_enabled?/1" data-no-tooltip="" translate="no">experimental_features_enabled?(user)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if experimental features are enabled for a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_api_token/1" data-no-tooltip="" translate="no">generate_api_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates an API token for a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_auth_token/1" data-no-tooltip="" translate="no">generate_auth_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates an auth token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_sudo_session_token/1" data-no-tooltip="" translate="no">generate_sudo_session_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates a 2FA session token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#generate_user_session_token/1" data-no-tooltip="" translate="no">generate_user_session_token(user)</a>

      </div>

        <div class="summary-synopsis"><p>Generates a session token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_preference/2" data-no-tooltip="" translate="no">get_preference(user, key)</a>

      </div>

        <div class="summary-synopsis"><p>Retrieves a specific preference value for a given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_token!/1" data-no-tooltip="" translate="no">get_token!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user/1" data-no-tooltip="" translate="no">get_user(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user!/1" data-no-tooltip="" translate="no">get_user!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_api_token/1" data-no-tooltip="" translate="no">get_user_by_api_token(claims)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user with the given signed token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_auth_token/1" data-no-tooltip="" translate="no">get_user_by_auth_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user with the given signed token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_email/1" data-no-tooltip="" translate="no">get_user_by_email(email)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a user by email.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_email_and_password/2" data-no-tooltip="" translate="no">get_user_by_email_and_password(email, password)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a user by email and password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_reset_password_token/1" data-no-tooltip="" translate="no">get_user_by_reset_password_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user by reset password token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_by_session_token/1" data-no-tooltip="" translate="no">get_user_by_session_token(token)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the user with the given signed token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_user_totp/1" data-no-tooltip="" translate="no">get_user_totp(user)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single UserTOTP if any exists.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_users_to_alert_for_project/1" data-no-tooltip="" translate="no">get_users_to_alert_for_project(map)</a>

      </div>

        <div class="summary-synopsis"><p>Gets all users to alert of workflow failure for a project</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_activity_in_projects?/1" data-no-tooltip="" translate="no">has_activity_in_projects?(user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#has_one_superuser?/0" data-no-tooltip="" translate="no">has_one_superuser?()</a>

      </div>

        <div class="summary-synopsis"><p>Used to determine if there is at least one Superuser in the system.
This triggers the setup page on fresh installs.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_api_tokens/1" data-no-tooltip="" translate="no">list_api_tokens(user)</a>

      </div>

        <div class="summary-synopsis"><p>Lists all user tokens</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_user_backup_codes/1" data-no-tooltip="" translate="no">list_user_backup_codes(user)</a>

      </div>

        <div class="summary-synopsis"><p>Lists the user backup codes</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_users/0" data-no-tooltip="" translate="no">list_users()</a>

      </div>

        <div class="summary-synopsis"><p>Returns the list of users.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_users_by_emails/1" data-no-tooltip="" translate="no">list_users_by_emails(emails)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the list of users with the given emails</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#perform/1" data-no-tooltip="" translate="no">perform(job)</a>

      </div>

        <div class="summary-synopsis"><p>Perform, when called with %{&quot;type&quot; =&gt; &quot;purge_deleted&quot;} will find users that are ready for permanent deletion and purge them.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#purge_user/1" data-no-tooltip="" translate="no">purge_user(id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#regenerate_user_backup_codes/1" data-no-tooltip="" translate="no">regenerate_user_backup_codes(user)</a>

      </div>

        <div class="summary-synopsis"><p>Regenerates the user backup codes</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#register_superuser/1" data-no-tooltip="" translate="no">register_superuser(attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Registers a superuser.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#register_user/1" data-no-tooltip="" translate="no">register_user(attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Registers a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#remind_account_confirmation/1" data-no-tooltip="" translate="no">remind_account_confirmation(user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#request_email_update/2" data-no-tooltip="" translate="no">request_email_update(user, new_email)</a>

      </div>

        <div class="summary-synopsis"><p>Delivers the update email instructions to the given user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reset_user_password/2" data-no-tooltip="" translate="no">reset_user_password(user, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Resets the user password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#schedule_user_deletion/2" data-no-tooltip="" translate="no">schedule_user_deletion(user, email)</a>

      </div>

        <div class="summary-synopsis"><p>Given a user and a confirmation email, this function sets a scheduled deletion
date based on the PURGE_DELETED_AFTER_DAYS environment variable. If no ENV is
set, this date defaults to NOW but the automatic user purge cronjob will never
run. (Note that subsequent logins will be blocked for users pending deletion.)</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#subscribe/0" data-no-tooltip="" translate="no">subscribe()</a>

      </div>

        <div class="summary-synopsis"><p>See <a><code class="inline">Lightning.Accounts.Events.subscribe/0</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#sudo_session_token_valid?/2" data-no-tooltip="" translate="no">sudo_session_token_valid?(user, token)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if the given sudo token for the user is valid</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_details/2" data-no-tooltip="" translate="no">update_user_details(user, attrs \\ %{})</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_email/2" data-no-tooltip="" translate="no">update_user_email(user, token)</a>

      </div>

        <div class="summary-synopsis"><p>Updates the user email using the given token.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_info/2" data-no-tooltip="" translate="no">update_user_info(user, attrs)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_password/3" data-no-tooltip="" translate="no">update_user_password(user, password, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Updates the user password.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_preference/3" data-no-tooltip="" translate="no">update_user_preference(user, key, value)</a>

      </div>

        <div class="summary-synopsis"><p>Updates a specific key in the user's preferences.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_user_preferences/2" data-no-tooltip="" translate="no">update_user_preferences(user, preferences)</a>

      </div>

        <div class="summary-synopsis"><p>Updates the user preferences.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#upsert_user_totp/2" data-no-tooltip="" translate="no">upsert_user_totp(totp, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Updates or Inserts the user's TOTP</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#valid_user_backup_code?/2" data-no-tooltip="" translate="no">valid_user_backup_code?(user, code)</a>

      </div>

        <div class="summary-synopsis"><p>Validates if the given Backup code is valid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#valid_user_totp?/2" data-no-tooltip="" translate="no">valid_user_totp?(user, code)</a>

      </div>

        <div class="summary-synopsis"><p>Validates if the given TOTP code is valid.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#validate_change_user_email/2" data-no-tooltip="" translate="no">validate_change_user_email(user, params \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Validates the changes for updating a user's email address.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>

    <div class="functions-list">
<section class="detail" id="apply_user_email/3">

  <div class="detail-header">
    <a href="#apply_user_email/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">apply_user_email(user, password, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L482" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Emulates that the email will change without actually changing
it in the database.</p><h2 id="apply_user_email/3-examples" class="section-heading"><a href="#apply_user_email/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">apply_user_email</span><span class="p" data-group-id="2055012524-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;valid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2055012524-2">%{</span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="2055012524-2">}</span><span class="p" data-group-id="2055012524-1">)</span><span class="w">
</span><span class="p" data-group-id="2055012524-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2055012524-4">%</span><span class="nc" data-group-id="2055012524-4">User</span><span class="p" data-group-id="2055012524-4">{</span><span class="p" data-group-id="2055012524-4">}</span><span class="p" data-group-id="2055012524-3">}</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:superuser</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="n">apply_user_email</span><span class="p" data-group-id="2055012524-5">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2055012524-6">%{</span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="2055012524-6">}</span><span class="p" data-group-id="2055012524-5">)</span><span class="w">
</span><span class="p" data-group-id="2055012524-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2055012524-8">%</span><span class="nc" data-group-id="2055012524-8">Ecto.Changeset</span><span class="p" data-group-id="2055012524-8">{</span><span class="p" data-group-id="2055012524-8">}</span><span class="p" data-group-id="2055012524-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="cancel_scheduled_deletion/1">

  <div class="detail-header">
    <a href="#cancel_scheduled_deletion/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cancel_scheduled_deletion(user_id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L460" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="change_scheduled_deletion/2">

    <span id="change_scheduled_deletion/1"></span>

  <div class="detail-header">
    <a href="#change_scheduled_deletion/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_scheduled_deletion(user, attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L456" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user scheduled_deletion.</p><h2 id="change_scheduled_deletion/2-examples" class="section-heading"><a href="#change_scheduled_deletion/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_scheduled_deletion</span><span class="p" data-group-id="6673909334-1">(</span><span class="n">user</span><span class="p" data-group-id="6673909334-1">)</span><span class="w">
</span><span class="p" data-group-id="6673909334-2">%</span><span class="nc" data-group-id="6673909334-2">Ecto.Changeset</span><span class="p" data-group-id="6673909334-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6673909334-3">%</span><span class="nc" data-group-id="6673909334-3">User</span><span class="p" data-group-id="6673909334-3">{</span><span class="p" data-group-id="6673909334-3">}</span><span class="p" data-group-id="6673909334-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_superuser_registration/1">

    <span id="change_superuser_registration/0"></span>

  <div class="detail-header">
    <a href="#change_superuser_registration/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_superuser_registration(attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L357" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> change_superuser_registration(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) :: <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()</pre>

      </div>

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking superuser changes.</p><h2 id="change_superuser_registration/1-examples" class="section-heading"><a href="#change_superuser_registration/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_superuser_registration</span><span class="p" data-group-id="4852676537-1">(</span><span class="n">user</span><span class="p" data-group-id="4852676537-1">)</span><span class="w">
</span><span class="p" data-group-id="4852676537-2">%</span><span class="nc" data-group-id="4852676537-2">Ecto.Changeset</span><span class="p" data-group-id="4852676537-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4852676537-3">%</span><span class="nc" data-group-id="4852676537-3">User</span><span class="p" data-group-id="4852676537-3">{</span><span class="p" data-group-id="4852676537-3">}</span><span class="p" data-group-id="4852676537-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_user/2">

  <div class="detail-header">
    <a href="#change_user/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_user(user, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L637" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="change_user_email/2">

    <span id="change_user_email/1"></span>

  <div class="detail-header">
    <a href="#change_user_email/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_user_email(user, attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L443" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user email.</p><h2 id="change_user_email/2-examples" class="section-heading"><a href="#change_user_email/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_user_email</span><span class="p" data-group-id="8226522864-1">(</span><span class="n">user</span><span class="p" data-group-id="8226522864-1">)</span><span class="w">
</span><span class="p" data-group-id="8226522864-2">%</span><span class="nc" data-group-id="8226522864-2">Ecto.Changeset</span><span class="p" data-group-id="8226522864-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8226522864-3">%</span><span class="nc" data-group-id="8226522864-3">User</span><span class="p" data-group-id="8226522864-3">{</span><span class="p" data-group-id="8226522864-3">}</span><span class="p" data-group-id="8226522864-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_user_info/2">

    <span id="change_user_info/1"></span>

  <div class="detail-header">
    <a href="#change_user_info/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_user_info(user, attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L407" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="change_user_password/2">

    <span id="change_user_password/1"></span>

  <div class="detail-header">
    <a href="#change_user_password/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_user_password(user, attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L633" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the user password.</p><h2 id="change_user_password/2-examples" class="section-heading"><a href="#change_user_password/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_user_password</span><span class="p" data-group-id="6182181973-1">(</span><span class="n">user</span><span class="p" data-group-id="6182181973-1">)</span><span class="w">
</span><span class="p" data-group-id="6182181973-2">%</span><span class="nc" data-group-id="6182181973-2">Ecto.Changeset</span><span class="p" data-group-id="6182181973-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6182181973-3">%</span><span class="nc" data-group-id="6182181973-3">User</span><span class="p" data-group-id="6182181973-3">{</span><span class="p" data-group-id="6182181973-3">}</span><span class="p" data-group-id="6182181973-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="change_user_registration/1">

    <span id="change_user_registration/0"></span>

  <div class="detail-header">
    <a href="#change_user_registration/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_user_registration(attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L398" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking user changes.</p><h2 id="change_user_registration/1-examples" class="section-heading"><a href="#change_user_registration/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_user_registration</span><span class="p" data-group-id="7676764027-1">(</span><span class="n">user</span><span class="p" data-group-id="7676764027-1">)</span><span class="w">
</span><span class="p" data-group-id="7676764027-2">%</span><span class="nc" data-group-id="7676764027-2">Ecto.Changeset</span><span class="p" data-group-id="7676764027-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7676764027-3">%</span><span class="nc" data-group-id="7676764027-3">User</span><span class="p" data-group-id="7676764027-3">{</span><span class="p" data-group-id="7676764027-3">}</span><span class="p" data-group-id="7676764027-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="confirm_user/1">

  <div class="detail-header">
    <a href="#confirm_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">confirm_user(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L917" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Confirms a user by the given token.</p><p>If the token matches, the user account is marked as confirmed
and the token is deleted.</p>
  </section>
</section>
<section class="detail" id="confirmation_required?/1">

  <div class="detail-header">
    <a href="#confirmation_required?/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">confirmation_required?(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1035" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="create_user/1">

  <div class="detail-header">
    <a href="#create_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">create_user(attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L98" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="delete_auth_token/1">

  <div class="detail-header">
    <a href="#delete_auth_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_auth_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L797" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Deletes the signed token with the given context.</p>
  </section>
</section>
<section class="detail" id="delete_session_token/1">

  <div class="detail-header">
    <a href="#delete_session_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_session_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L724" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Deletes the signed token with the given context.</p>
  </section>
</section>
<section class="detail" id="delete_sudo_session_token/1">

  <div class="detail-header">
    <a href="#delete_sudo_session_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_sudo_session_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L753" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Deletes the signed token with the given context.</p>
  </section>
</section>
<section class="detail" id="delete_token/1">

  <div class="detail-header">
    <a href="#delete_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L843" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Deletes a token.</p><h2 id="delete_token/1-examples" class="section-heading"><a href="#delete_token/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">delete_token</span><span class="p" data-group-id="3645923183-1">(</span><span class="n">token</span><span class="p" data-group-id="3645923183-1">)</span><span class="w">
</span><span class="p" data-group-id="3645923183-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3645923183-3">%</span><span class="nc" data-group-id="3645923183-3">UserToken</span><span class="p" data-group-id="3645923183-3">{</span><span class="p" data-group-id="3645923183-3">}</span><span class="p" data-group-id="3645923183-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">delete_token</span><span class="p" data-group-id="3645923183-4">(</span><span class="n">token</span><span class="p" data-group-id="3645923183-4">)</span><span class="w">
</span><span class="p" data-group-id="3645923183-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3645923183-6">%</span><span class="nc" data-group-id="3645923183-6">Ecto.Changeset</span><span class="p" data-group-id="3645923183-6">{</span><span class="p" data-group-id="3645923183-6">}</span><span class="p" data-group-id="3645923183-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_user/1">

  <div class="detail-header">
    <a href="#delete_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_user(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L620" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Deletes a user.</p><h2 id="delete_user/1-examples" class="section-heading"><a href="#delete_user/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">delete_user</span><span class="p" data-group-id="4886173881-1">(</span><span class="n">user</span><span class="p" data-group-id="4886173881-1">)</span><span class="w">
</span><span class="p" data-group-id="4886173881-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4886173881-3">%</span><span class="nc" data-group-id="4886173881-3">User</span><span class="p" data-group-id="4886173881-3">{</span><span class="p" data-group-id="4886173881-3">}</span><span class="p" data-group-id="4886173881-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">delete_user</span><span class="p" data-group-id="4886173881-4">(</span><span class="n">user</span><span class="p" data-group-id="4886173881-4">)</span><span class="w">
</span><span class="p" data-group-id="4886173881-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4886173881-6">%</span><span class="nc" data-group-id="4886173881-6">Ecto.Changeset</span><span class="p" data-group-id="4886173881-6">{</span><span class="p" data-group-id="4886173881-6">}</span><span class="p" data-group-id="4886173881-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_user_totp/1">

  <div class="detail-header">
    <a href="#delete_user_totp/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_user_totp(totp)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L242" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_user_totp(<a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>()) ::
  {:ok, <a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Deletes the given user's TOTP</p>
  </section>
</section>
<section class="detail" id="deliver_user_confirmation_instructions/1">

  <div class="detail-header">
    <a href="#deliver_user_confirmation_instructions/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">deliver_user_confirmation_instructions(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L878" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Delivers the confirmation email instructions to the given user.</p><h2 id="deliver_user_confirmation_instructions/1-examples" class="section-heading"><a href="#deliver_user_confirmation_instructions/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">deliver_user_confirmation_instructions</span><span class="p" data-group-id="9378742719-1">(</span><span class="n">user</span><span class="p" data-group-id="9378742719-1">)</span><span class="w">
</span><span class="p" data-group-id="9378742719-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9378742719-3">%{</span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="9378742719-3">}</span><span class="p" data-group-id="9378742719-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">deliver_user_confirmation_instructions</span><span class="p" data-group-id="9378742719-4">(</span><span class="n">confirmed_user</span><span class="p" data-group-id="9378742719-4">)</span><span class="w">
</span><span class="p" data-group-id="9378742719-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:already_confirmed</span><span class="p" data-group-id="9378742719-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="deliver_user_confirmation_instructions/2">

  <div class="detail-header">
    <a href="#deliver_user_confirmation_instructions/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">deliver_user_confirmation_instructions(registerer, user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L889" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="deliver_user_reset_password_instructions/2">

  <div class="detail-header">
    <a href="#deliver_user_reset_password_instructions/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">deliver_user_reset_password_instructions(user, reset_password_url_fun)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L949" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Delivers the reset password email to the given user.</p><h2 id="deliver_user_reset_password_instructions/2-examples" class="section-heading"><a href="#deliver_user_reset_password_instructions/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">deliver_user_reset_password_instructions</span><span class="p" data-group-id="0692915046-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_reset_password_url</span><span class="p" data-group-id="0692915046-2">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="ss">:edit</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="0692915046-2">)</span><span class="p" data-group-id="0692915046-1">)</span><span class="w">
</span><span class="p" data-group-id="0692915046-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0692915046-4">%{</span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="0692915046-4">}</span><span class="p" data-group-id="0692915046-3">}</span></code></pre>
  </section>
</section>
<section class="detail" id="exchange_auth_token/1">

  <div class="detail-header">
    <a href="#exchange_auth_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">exchange_auth_token(auth_token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L775" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Exchanges an auth token for a session token.</p><p>The auth token is removed from the database if successful.</p>
  </section>
</section>
<section class="detail" id="experimental_features_enabled?/1">

  <div class="detail-header">
    <a href="#experimental_features_enabled?/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">experimental_features_enabled?(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1116" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> experimental_features_enabled?(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Checks if experimental features are enabled for a user.</p><p>Returns true if the user has experimental features enabled in their preferences,
false otherwise. Safely handles nil preferences map and defaults to false when
the &quot;experimental_features&quot; key is not set.</p><h2 id="experimental_features_enabled?/1-examples" class="section-heading"><a href="#experimental_features_enabled?/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">experimental_features_enabled?</span><span class="p" data-group-id="5033163860-1">(</span><span class="p" data-group-id="5033163860-2">%</span><span class="nc" data-group-id="5033163860-2">User</span><span class="p" data-group-id="5033163860-2">{</span><span class="ss">preferences</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5033163860-3">%{</span><span class="s">&quot;experimental_features&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5033163860-3">}</span><span class="p" data-group-id="5033163860-2">}</span><span class="p" data-group-id="5033163860-1">)</span><span class="w">
</span><span class="no">true</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">experimental_features_enabled?</span><span class="p" data-group-id="5033163860-4">(</span><span class="p" data-group-id="5033163860-5">%</span><span class="nc" data-group-id="5033163860-5">User</span><span class="p" data-group-id="5033163860-5">{</span><span class="ss">preferences</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5033163860-6">%{</span><span class="p" data-group-id="5033163860-6">}</span><span class="p" data-group-id="5033163860-5">}</span><span class="p" data-group-id="5033163860-4">)</span><span class="w">
</span><span class="no">false</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">experimental_features_enabled?</span><span class="p" data-group-id="5033163860-7">(</span><span class="p" data-group-id="5033163860-8">%</span><span class="nc" data-group-id="5033163860-8">User</span><span class="p" data-group-id="5033163860-8">{</span><span class="ss">preferences</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="5033163860-8">}</span><span class="p" data-group-id="5033163860-7">)</span><span class="w">
</span><span class="no">false</span></code></pre>
  </section>
</section>
<section class="detail" id="generate_api_token/1">

  <div class="detail-header">
    <a href="#generate_api_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">generate_api_token(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L807" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Generates an API token for a user.</p>
  </section>
</section>
<section class="detail" id="generate_auth_token/1">

  <div class="detail-header">
    <a href="#generate_auth_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">generate_auth_token(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L764" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Generates an auth token.</p>
  </section>
</section>
<section class="detail" id="generate_sudo_session_token/1">

  <div class="detail-header">
    <a href="#generate_sudo_session_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">generate_sudo_session_token(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L734" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Generates a 2FA session token.</p>
  </section>
</section>
<section class="detail" id="generate_user_session_token/1">

  <div class="detail-header">
    <a href="#generate_user_session_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">generate_user_session_token(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L707" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Generates a session token.</p>
  </section>
</section>
<section class="detail" id="get_preference/2">

  <div class="detail-header">
    <a href="#get_preference/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_preference(user, key)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1058" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_preference(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()</pre>

      </div>

<p>Retrieves a specific preference value for a given user.</p><p>Returns the value of the specified key from the user's preferences.
If the value is the string <code class="inline">&quot;true&quot;</code> or <code class="inline">&quot;false&quot;</code>, it is converted to a boolean.</p><h2 id="get_preference/2-examples" class="section-heading"><a href="#get_preference/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_preference</span><span class="p" data-group-id="0568391793-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;editor.orientation&quot;</span><span class="p" data-group-id="0568391793-1">)</span><span class="w">
</span><span class="s">&quot;vertical&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_preference</span><span class="p" data-group-id="0568391793-2">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;notifications.enabled&quot;</span><span class="p" data-group-id="0568391793-2">)</span><span class="w">
</span><span class="no">true</span></code></pre>
  </section>
</section>
<section class="detail" id="get_token!/1">

  <div class="detail-header">
    <a href="#get_token!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_token!(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L199" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a single token.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if the UserToken does not exist.</p><h2 id="get_token!/1-examples" class="section-heading"><a href="#get_token!/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_token!</span><span class="p" data-group-id="8709138593-1">(</span><span class="mi">123</span><span class="p" data-group-id="8709138593-1">)</span><span class="w">
</span><span class="p" data-group-id="8709138593-2">%</span><span class="nc" data-group-id="8709138593-2">UserToken</span><span class="p" data-group-id="8709138593-2">{</span><span class="p" data-group-id="8709138593-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_token!</span><span class="p" data-group-id="8709138593-3">(</span><span class="mi">456</span><span class="p" data-group-id="8709138593-3">)</span><span class="w">
</span><span class="gt">** (Ecto.NoResultsError)</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user/1">

  <div class="detail-header">
    <a href="#get_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L183" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a single user.</p><h2 id="get_user/1-examples" class="section-heading"><a href="#get_user/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user</span><span class="p" data-group-id="8544985484-1">(</span><span class="mi">123</span><span class="p" data-group-id="8544985484-1">)</span><span class="w">
</span><span class="p" data-group-id="8544985484-2">%</span><span class="nc" data-group-id="8544985484-2">User</span><span class="p" data-group-id="8544985484-2">{</span><span class="p" data-group-id="8544985484-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user!</span><span class="p" data-group-id="8544985484-3">(</span><span class="mi">456</span><span class="p" data-group-id="8544985484-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user!/1">

  <div class="detail-header">
    <a href="#get_user!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user!(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L170" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a single user.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if the User does not exist.</p><p>See <a href="#get_user/1"><code class="inline">get_user/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_user_by_api_token/1">

  <div class="detail-header">
    <a href="#get_user_by_api_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_by_api_token(claims)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L816" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets the user with the given signed token.</p>
  </section>
</section>
<section class="detail" id="get_user_by_auth_token/1">

  <div class="detail-header">
    <a href="#get_user_by_auth_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_by_auth_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L789" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets the user with the given signed token.</p>
  </section>
</section>
<section class="detail" id="get_user_by_email/1">

  <div class="detail-header">
    <a href="#get_user_by_email/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_by_email(email)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L141" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a user by email.</p><h2 id="get_user_by_email/1-examples" class="section-heading"><a href="#get_user_by_email/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email</span><span class="p" data-group-id="3557431031-1">(</span><span class="s">&quot;foo@example.com&quot;</span><span class="p" data-group-id="3557431031-1">)</span><span class="w">
</span><span class="p" data-group-id="3557431031-2">%</span><span class="nc" data-group-id="3557431031-2">User</span><span class="p" data-group-id="3557431031-2">{</span><span class="p" data-group-id="3557431031-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email</span><span class="p" data-group-id="3557431031-3">(</span><span class="s">&quot;unknown@example.com&quot;</span><span class="p" data-group-id="3557431031-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_email_and_password/2">

  <div class="detail-header">
    <a href="#get_user_by_email_and_password/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_by_email_and_password(email, password)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L157" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a user by email and password.</p><h2 id="get_user_by_email_and_password/2-examples" class="section-heading"><a href="#get_user_by_email_and_password/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email_and_password</span><span class="p" data-group-id="3978961519-1">(</span><span class="s">&quot;foo@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;correct_password&quot;</span><span class="p" data-group-id="3978961519-1">)</span><span class="w">
</span><span class="p" data-group-id="3978961519-2">%</span><span class="nc" data-group-id="3978961519-2">User</span><span class="p" data-group-id="3978961519-2">{</span><span class="p" data-group-id="3978961519-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_email_and_password</span><span class="p" data-group-id="3978961519-3">(</span><span class="s">&quot;foo@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid_password&quot;</span><span class="p" data-group-id="3978961519-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_reset_password_token/1">

  <div class="detail-header">
    <a href="#get_user_by_reset_password_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_by_reset_password_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L977" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets the user by reset password token.</p><h2 id="get_user_by_reset_password_token/1-examples" class="section-heading"><a href="#get_user_by_reset_password_token/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_reset_password_token</span><span class="p" data-group-id="3630007509-1">(</span><span class="s">&quot;validtoken&quot;</span><span class="p" data-group-id="3630007509-1">)</span><span class="w">
</span><span class="p" data-group-id="3630007509-2">%</span><span class="nc" data-group-id="3630007509-2">User</span><span class="p" data-group-id="3630007509-2">{</span><span class="p" data-group-id="3630007509-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_user_by_reset_password_token</span><span class="p" data-group-id="3630007509-3">(</span><span class="s">&quot;invalidtoken&quot;</span><span class="p" data-group-id="3630007509-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_user_by_session_token/1">

  <div class="detail-header">
    <a href="#get_user_by_session_token/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_by_session_token(token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L716" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets the user with the given signed token.</p>
  </section>
</section>
<section class="detail" id="get_user_totp/1">

  <div class="detail-header">
    <a href="#get_user_totp/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_user_totp(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L204" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a single UserTOTP if any exists.</p>
  </section>
</section>
<section class="detail" id="get_users_to_alert_for_project/1">

  <div class="detail-header">
    <a href="#get_users_to_alert_for_project/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_users_to_alert_for_project(map)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1026" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets all users to alert of workflow failure for a project</p>
  </section>
</section>
<section class="detail" id="has_activity_in_projects?/1">

  <div class="detail-header">
    <a href="#has_activity_in_projects?/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">has_activity_in_projects?(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L29" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="has_one_superuser?/0">

  <div class="detail-header">
    <a href="#has_one_superuser?/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">has_one_superuser?()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1018" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> has_one_superuser?() :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Used to determine if there is at least one Superuser in the system.
This triggers the setup page on fresh installs.</p>
  </section>
</section>
<section class="detail" id="list_api_tokens/1">

  <div class="detail-header">
    <a href="#list_api_tokens/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_api_tokens(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L850" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Lists all user tokens</p>
  </section>
</section>
<section class="detail" id="list_user_backup_codes/1">

  <div class="detail-header">
    <a href="#list_user_backup_codes/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_user_backup_codes(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L324" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_user_backup_codes(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  [<a href="Lightning.Accounts.UserBackupCode.html#t:t/0">Lightning.Accounts.UserBackupCode.t</a>(), ...] | []</pre>

      </div>

<p>Lists the user backup codes</p>
  </section>
</section>
<section class="detail" id="list_users/0">

  <div class="detail-header">
    <a href="#list_users/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_users()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L113" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns the list of users.</p><h2 id="list_users/0-examples" class="section-heading"><a href="#list_users/0-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">list_users</span><span class="p" data-group-id="4996165974-1">(</span><span class="p" data-group-id="4996165974-1">)</span><span class="w">
</span><span class="p" data-group-id="4996165974-2">[</span><span class="p" data-group-id="4996165974-3">%</span><span class="nc" data-group-id="4996165974-3">User</span><span class="p" data-group-id="4996165974-3">{</span><span class="p" data-group-id="4996165974-3">}</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="4996165974-2">]</span></code></pre>
  </section>
</section>
<section class="detail" id="list_users_by_emails/1">

  <div class="detail-header">
    <a href="#list_users_by_emails/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_users_by_emails(emails)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L120" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns the list of users with the given emails</p>
  </section>
</section>
<section class="detail" id="perform/1">

  <div class="detail-header">
    <a href="#perform/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">perform(job)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L71" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Perform, when called with %{&quot;type&quot; =&gt; &quot;purge_deleted&quot;} will find users that are ready for permanent deletion and purge them.</p>
  </section>
</section>
<section class="detail" id="purge_user/1">

  <div class="detail-header">
    <a href="#purge_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">purge_user(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L41" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> purge_user(id :: <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: :ok</pre>

      </div>


  </section>
</section>
<section class="detail" id="regenerate_user_backup_codes/1">

  <div class="detail-header">
    <a href="#regenerate_user_backup_codes/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">regenerate_user_backup_codes(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L307" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> regenerate_user_backup_codes(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  {:ok, <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Regenerates the user backup codes</p>
  </section>
</section>
<section class="detail" id="register_superuser/1">

  <div class="detail-header">
    <a href="#register_superuser/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">register_superuser(attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L341" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Registers a superuser.</p><h2 id="register_superuser/1-examples" class="section-heading"><a href="#register_superuser/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">register_superuser</span><span class="p" data-group-id="5167211030-1">(</span><span class="p" data-group-id="5167211030-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="5167211030-2">}</span><span class="p" data-group-id="5167211030-1">)</span><span class="w">
</span><span class="p" data-group-id="5167211030-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5167211030-4">%</span><span class="nc" data-group-id="5167211030-4">User</span><span class="p" data-group-id="5167211030-4">{</span><span class="p" data-group-id="5167211030-4">}</span><span class="p" data-group-id="5167211030-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">register_superuser</span><span class="p" data-group-id="5167211030-5">(</span><span class="p" data-group-id="5167211030-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="5167211030-6">}</span><span class="p" data-group-id="5167211030-5">)</span><span class="w">
</span><span class="p" data-group-id="5167211030-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5167211030-8">%</span><span class="nc" data-group-id="5167211030-8">Ecto.Changeset</span><span class="p" data-group-id="5167211030-8">{</span><span class="p" data-group-id="5167211030-8">}</span><span class="p" data-group-id="5167211030-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="register_user/1">

  <div class="detail-header">
    <a href="#register_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">register_user(attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L377" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> register_user(
  :invalid
  | %{optional(:__struct__) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">none</a>(), optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}
) ::
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()</pre>

      </div>

<p>Registers a user.</p><h2 id="register_user/1-examples" class="section-heading"><a href="#register_user/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">register_user</span><span class="p" data-group-id="6879317217-1">(</span><span class="p" data-group-id="6879317217-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="6879317217-2">}</span><span class="p" data-group-id="6879317217-1">)</span><span class="w">
</span><span class="p" data-group-id="6879317217-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6879317217-4">%</span><span class="nc" data-group-id="6879317217-4">User</span><span class="p" data-group-id="6879317217-4">{</span><span class="p" data-group-id="6879317217-4">}</span><span class="p" data-group-id="6879317217-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">register_user</span><span class="p" data-group-id="6879317217-5">(</span><span class="p" data-group-id="6879317217-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="6879317217-6">}</span><span class="p" data-group-id="6879317217-5">)</span><span class="w">
</span><span class="p" data-group-id="6879317217-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6879317217-8">%</span><span class="nc" data-group-id="6879317217-8">Ecto.Changeset</span><span class="p" data-group-id="6879317217-8">{</span><span class="p" data-group-id="6879317217-8">}</span><span class="p" data-group-id="6879317217-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="remind_account_confirmation/1">

  <div class="detail-header">
    <a href="#remind_account_confirmation/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">remind_account_confirmation(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L904" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="request_email_update/2">

  <div class="detail-header">
    <a href="#request_email_update/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">request_email_update(user, new_email)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L533" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Delivers the update email instructions to the given user.</p><h2 id="request_email_update/2-examples" class="section-heading"><a href="#request_email_update/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">request_email_update</span><span class="p" data-group-id="0175968282-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">new_email</span><span class="p" data-group-id="0175968282-1">)</span><span class="w">
</span><span class="ss">:ok</span></code></pre>
  </section>
</section>
<section class="detail" id="reset_user_password/2">

  <div class="detail-header">
    <a href="#reset_user_password/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">reset_user_password(user, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L999" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Resets the user password.</p><h2 id="reset_user_password/2-examples" class="section-heading"><a href="#reset_user_password/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">reset_user_password</span><span class="p" data-group-id="9641884080-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9641884080-2">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;new long password&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">password_confirmation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;new long password&quot;</span><span class="p" data-group-id="9641884080-2">}</span><span class="p" data-group-id="9641884080-1">)</span><span class="w">
</span><span class="p" data-group-id="9641884080-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9641884080-4">%</span><span class="nc" data-group-id="9641884080-4">User</span><span class="p" data-group-id="9641884080-4">{</span><span class="p" data-group-id="9641884080-4">}</span><span class="p" data-group-id="9641884080-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">reset_user_password</span><span class="p" data-group-id="9641884080-5">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9641884080-6">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;valid&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">password_confirmation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;not the same&quot;</span><span class="p" data-group-id="9641884080-6">}</span><span class="p" data-group-id="9641884080-5">)</span><span class="w">
</span><span class="p" data-group-id="9641884080-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9641884080-8">%</span><span class="nc" data-group-id="9641884080-8">Ecto.Changeset</span><span class="p" data-group-id="9641884080-8">{</span><span class="p" data-group-id="9641884080-8">}</span><span class="p" data-group-id="9641884080-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="schedule_user_deletion/2">

  <div class="detail-header">
    <a href="#schedule_user_deletion/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">schedule_user_deletion(user, email)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L678" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Given a user and a confirmation email, this function sets a scheduled deletion
date based on the PURGE_DELETED_AFTER_DAYS environment variable. If no ENV is
set, this date defaults to NOW but the automatic user purge cronjob will never
run. (Note that subsequent logins will be blocked for users pending deletion.)</p>
  </section>
</section>
<section class="detail" id="subscribe/0">

  <div class="detail-header">
    <a href="#subscribe/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">subscribe()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L27" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>See <a href="Lightning.Accounts.Events.html#subscribe/0"><code class="inline">Lightning.Accounts.Events.subscribe/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="sudo_session_token_valid?/2">

  <div class="detail-header">
    <a href="#sudo_session_token_valid?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">sudo_session_token_valid?(user, token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L743" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Checks if the given sudo token for the user is valid</p>
  </section>
</section>
<section class="detail" id="update_user_details/2">

    <span id="update_user_details/1"></span>

  <div class="detail-header">
    <a href="#update_user_details/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_user_details(user, attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L402" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_user_email/2">

  <div class="detail-header">
    <a href="#update_user_email/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_user_email(user, token)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L495" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Updates the user email using the given token.</p><p>If the token matches, the user email is updated and the token is deleted.
The confirmed_at date is also updated to the current time.</p>
  </section>
</section>
<section class="detail" id="update_user_info/2">

  <div class="detail-header">
    <a href="#update_user_info/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_user_info(user, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L411" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_user_password/3">

  <div class="detail-header">
    <a href="#update_user_password/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_user_password(user, password, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L653" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Updates the user password.</p><h2 id="update_user_password/3-examples" class="section-heading"><a href="#update_user_password/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">update_user_password</span><span class="p" data-group-id="9892567475-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;valid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9892567475-2">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="9892567475-2">}</span><span class="p" data-group-id="9892567475-1">)</span><span class="w">
</span><span class="p" data-group-id="9892567475-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9892567475-4">%</span><span class="nc" data-group-id="9892567475-4">User</span><span class="p" data-group-id="9892567475-4">{</span><span class="p" data-group-id="9892567475-4">}</span><span class="p" data-group-id="9892567475-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">update_user_password</span><span class="p" data-group-id="9892567475-5">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;invalid password&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9892567475-6">%{</span><span class="ss">password</span><span class="p">:</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="9892567475-6">}</span><span class="p" data-group-id="9892567475-5">)</span><span class="w">
</span><span class="p" data-group-id="9892567475-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9892567475-8">%</span><span class="nc" data-group-id="9892567475-8">Ecto.Changeset</span><span class="p" data-group-id="9892567475-8">{</span><span class="p" data-group-id="9892567475-8">}</span><span class="p" data-group-id="9892567475-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="update_user_preference/3">

  <div class="detail-header">
    <a href="#update_user_preference/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_user_preference(user, key, value)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L1087" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update_user_preference(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) ::
  {:ok, <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Updates a specific key in the user's preferences.</p><p>Merges the new key-value pair into the user's existing preferences and updates the database.</p><h2 id="update_user_preference/3-examples" class="section-heading"><a href="#update_user_preference/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">update_user_preference</span><span class="p" data-group-id="9483366214-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;editor.orientation&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vertical&quot;</span><span class="p" data-group-id="9483366214-1">)</span><span class="w">
</span><span class="p" data-group-id="9483366214-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9483366214-3">%</span><span class="nc" data-group-id="9483366214-3">User</span><span class="p" data-group-id="9483366214-3">{</span><span class="p" data-group-id="9483366214-3">}</span><span class="p" data-group-id="9483366214-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">update_user_preference</span><span class="p" data-group-id="9483366214-4">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;notifications.enabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="9483366214-4">)</span><span class="w">
</span><span class="p" data-group-id="9483366214-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9483366214-6">%</span><span class="nc" data-group-id="9483366214-6">User</span><span class="p" data-group-id="9483366214-6">{</span><span class="p" data-group-id="9483366214-6">}</span><span class="p" data-group-id="9483366214-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="update_user_preferences/2">

  <div class="detail-header">
    <a href="#update_user_preferences/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_user_preferences(user, preferences)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L424" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update_user_preferences(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) ::
  {:ok, <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Updates the user preferences.</p><h2 id="update_user_preferences/2-examples" class="section-heading"><a href="#update_user_preferences/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">update_user_preferences</span><span class="p" data-group-id="4590312941-1">(</span><span class="p" data-group-id="4590312941-2">%</span><span class="nc" data-group-id="4590312941-2">User</span><span class="p" data-group-id="4590312941-2">{</span><span class="p" data-group-id="4590312941-2">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4590312941-3">%{</span><span class="s">&quot;editor.orientaion&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;vertical&quot;</span><span class="p" data-group-id="4590312941-3">}</span><span class="p" data-group-id="4590312941-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="upsert_user_totp/2">

  <div class="detail-header">
    <a href="#upsert_user_totp/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">upsert_user_totp(totp, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L213" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> upsert_user_totp(<a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) ::
  {:ok, <a href="Lightning.Accounts.UserTOTP.html#t:t/0">Lightning.Accounts.UserTOTP.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Updates or Inserts the user's TOTP</p>
  </section>
</section>
<section class="detail" id="valid_user_backup_code?/2">

  <div class="detail-header">
    <a href="#valid_user_backup_code?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">valid_user_backup_code?(user, code)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L271" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> valid_user_backup_code?(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) :: true | false</pre>

      </div>

<p>Validates if the given Backup code is valid.</p>
  </section>
</section>
<section class="detail" id="valid_user_totp?/2">

  <div class="detail-header">
    <a href="#valid_user_totp?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">valid_user_totp?(user, code)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L261" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> valid_user_totp?(<a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) :: true | false</pre>

      </div>

<p>Validates if the given TOTP code is valid.</p>
  </section>
</section>
<section class="detail" id="validate_change_user_email/2">

    <span id="validate_change_user_email/1"></span>

  <div class="detail-header">
    <a href="#validate_change_user_email/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">validate_change_user_email(user, params \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/accounts.ex#L575" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Validates the changes for updating a user's email address.</p><p>This function ensures that:</p><ul><li>The <code class="inline">email</code> and <code class="inline">current_password</code> fields are present.</li><li>The new email is in a valid format.</li><li>The new email is different from the current one.</li><li>The provided <code class="inline">current_password</code> matches the user's password.</li></ul><h2 id="validate_change_user_email/2-parameters" class="section-heading"><a href="#validate_change_user_email/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">user</code>: The <code class="inline">%User{}</code> struct representing the current user.</li><li><code class="inline">params</code>: A map of parameters containing the new email and current password.</li></ul><h2 id="validate_change_user_email/2-returns" class="section-heading"><a href="#validate_change_user_email/2-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><p>An <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html"><code class="inline">Ecto.Changeset</code></a> containing any validation errors.</p><h2 id="validate_change_user_email/2-examples" class="section-heading"><a href="#validate_change_user_email/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">validate_change_user_email</span><span class="p" data-group-id="8596663547-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8596663547-2">%{</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;new@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;current_password&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;secret&quot;</span><span class="p" data-group-id="8596663547-2">}</span><span class="p" data-group-id="8596663547-1">)</span><span class="w">
</span><span class="p" data-group-id="8596663547-3">%</span><span class="nc" data-group-id="8596663547-3">Ecto.Changeset</span><span class="p" data-group-id="8596663547-3">{</span><span class="n">...</span><span class="p" data-group-id="8596663547-3">}</span></code></pre>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.4) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
