<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.4">
    <meta name="project" content="Lightning v2.15.4">


    <title>Lightning.Projects — Lightning v2.15.4</title>

    <link rel="stylesheet" href="dist/html-elixir-RLZO5U2C.css" />

    <script defer src="dist/sidebar_items-1B8A99BA.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-Y223O6DN.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://openfn.github.io/lightning" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Lightning" />
        </a>

      <div>
        <a href="https://openfn.github.io/lightning" class="sidebar-projectName" translate="no">
Lightning
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.15.4
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Lightning</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Lightning.Projects</span> 
      <small class="app-vsn" translate="no">(Lightning v2.15.4)</small>

    </h1>

      <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>The Projects context.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#add_project_users/3" data-no-tooltip="" translate="no">add_project_users(project, project_users, notify_users \\ true)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#append_project_head/2" data-no-tooltip="" translate="no">append_project_head(project, hash)</a>

      </div>

        <div class="summary-synopsis"><p>Appends a new 12-hex head hash to <code class="inline">project.version_history</code> (append-only).</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#append_project_head!/2" data-no-tooltip="" translate="no">append_project_head!(project, hash)</a>

      </div>

        <div class="summary-synopsis"><p>Like <a><code class="inline">append_project_head/2</code></a>, but raises on invalid input and performs the
append within a transaction that locks the project row.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cancel_scheduled_deletion/1" data-no-tooltip="" translate="no">cancel_scheduled_deletion(project_id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#change_project/2" data-no-tooltip="" translate="no">change_project(project, attrs \\ %{})</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking project changes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#compute_project_head_hash/1" data-no-tooltip="" translate="no">compute_project_head_hash(project_id)</a>

      </div>

        <div class="summary-synopsis"><p>Computes a deterministic 12-hex “project head” hash from the <em>latest</em> version
hash per workflow.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#create_project/2" data-no-tooltip="" translate="no">create_project(attrs \\ %{}, schedule_email? \\ true)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a project.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#create_sandbox/3" data-no-tooltip="" translate="no">create_sandbox(project, attrs, schedule_email? \\ false)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a sandbox under the given <code class="inline">parent</code> by delegating to <a><code class="inline">create_project/2</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_project/1" data-no-tooltip="" translate="no">delete_project(project)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a project and its related data, including workflows, work orders,
steps, jobs, runs, triggers, project users, project credentials, and dataclips</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_project_async/1" data-no-tooltip="" translate="no">delete_project_async(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_project_dataclips/2" data-no-tooltip="" translate="no">delete_project_dataclips(project, batch_size \\ 1000)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes project dataclips in batches</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_project_user!/1" data-no-tooltip="" translate="no">delete_project_user!(project_user)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a project user and removes their credentials from the project.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_project_workorders/2" data-no-tooltip="" translate="no">delete_project_workorders(project, batch_size \\ 1000)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes project work orders in batches</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_sandbox/2" data-no-tooltip="" translate="no">delete_sandbox(sandbox, actor)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a sandbox and all its descendant projects.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#descendant_of?/3" data-no-tooltip="" translate="no">descendant_of?(child_project, parent_project, root_project \\ nil)</a>

      </div>

        <div class="summary-synopsis"><p>Returns true if <code class="inline">child_project</code> is a descendant of <code class="inline">parent_project</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#export_project/3" data-no-tooltip="" translate="no">export_project(atom, project_id, snapshot_ids \\ nil)</a>

      </div>

        <div class="summary-synopsis"><p>Exports a project as yaml.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#find_users_to_notify_of_trigger_failure/1" data-no-tooltip="" translate="no">find_users_to_notify_of_trigger_failure(project_id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project/1" data-no-tooltip="" translate="no">get_project(id)</a>

      </div>

        <div class="summary-synopsis"><p>Fetches a project by id (root <strong>or</strong> sandbox) and preloads its direct <code class="inline">:parent</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project!/1" data-no-tooltip="" translate="no">get_project!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Fetches a project by id (root <strong>or</strong> sandbox) and preloads its direct <code class="inline">:parent</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_credential/2" data-no-tooltip="" translate="no">get_project_credential(project_id, credential_id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_for_run/1" data-no-tooltip="" translate="no">get_project_for_run(run)</a>

      </div>

        <div class="summary-synopsis"><p>Gets the project associated with a run.
Traverses Run → WorkOrder → Workflow → Project.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_user/1" data-no-tooltip="" translate="no">get_project_user(id)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_user/2" data-no-tooltip="" translate="no">get_project_user(project_id, user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_user!/1" data-no-tooltip="" translate="no">get_project_user!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single project_user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_user_role/2" data-no-tooltip="" translate="no">get_project_user_role(user, project)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the role of a user in a project.
Possible roles are :admin, :viewer, :editor, and :owner</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_users!/1" data-no-tooltip="" translate="no">get_project_users!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Get all project users for a given project</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_project_with_users!/1" data-no-tooltip="" translate="no">get_project_with_users!(id)</a>

      </div>

        <div class="summary-synopsis"><p>Gets a single project with it's members via <code class="inline">project_users</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_projects_for_user/1" data-no-tooltip="" translate="no">get_projects_for_user(user)</a>

      </div>

        <div class="summary-synopsis"><p>Fetches projects for a given user from the database.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_projects_overview/2" data-no-tooltip="" translate="no">get_projects_overview(user, opts \\ [])</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#invite_collaborators/3" data-no-tooltip="" translate="no">invite_collaborators(project, collaborators, inviter)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_project_admin_emails/1" data-no-tooltip="" translate="no">list_project_admin_emails(id)</a>

      </div>

        <div class="summary-synopsis"><p>Lists emails of users with <code class="inline">:owner</code> or <code class="inline">:admin</code> roles in the project</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_project_credentials/1" data-no-tooltip="" translate="no">list_project_credentials(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_project_files/2" data-no-tooltip="" translate="no">list_project_files(project, opts \\ [])</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_projects/0" data-no-tooltip="" translate="no">list_projects()</a>

      </div>

        <div class="summary-synopsis"><p>Returns the list of projects.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_projects_having_history_retention/0" data-no-tooltip="" translate="no">list_projects_having_history_retention()</a>

      </div>

        <div class="summary-synopsis"><p>Lists all projects that have history retention</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_sandboxes/1" data-no-tooltip="" translate="no">list_sandboxes(parent_id)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the <em>direct</em> sandboxes (children) of a parent project, ordered by <code class="inline">name</code> (ASC).</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_workflows/1" data-no-tooltip="" translate="no">list_workflows(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_workspace_projects/2" data-no-tooltip="" translate="no">list_workspace_projects(project_id_or_struct, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Returns all projects in a workspace hierarchy.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#member_of?/2" data-no-tooltip="" translate="no">member_of?(project, user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#perform/1" data-no-tooltip="" translate="no">perform(job)</a>

      </div>

        <div class="summary-synopsis"><p>Perform, when called with %{&quot;type&quot; =&gt; &quot;purge_deleted&quot;}
will find projects that are ready for permanent deletion and purge them.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_credentials_query/1" data-no-tooltip="" translate="no">project_credentials_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_dataclips_query/1" data-no-tooltip="" translate="no">project_dataclips_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_jobs_query/1" data-no-tooltip="" translate="no">project_jobs_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_run_step_query/1" data-no-tooltip="" translate="no">project_run_step_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_runs_query/1" data-no-tooltip="" translate="no">project_runs_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_steps_query/1" data-no-tooltip="" translate="no">project_steps_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_triggers_query/1" data-no-tooltip="" translate="no">project_triggers_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_users_query/1" data-no-tooltip="" translate="no">project_users_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_workflows_query/1" data-no-tooltip="" translate="no">project_workflows_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#project_workorders_query/1" data-no-tooltip="" translate="no">project_workorders_query(project)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#projects_for_user_query/1" data-no-tooltip="" translate="no">projects_for_user_query(user)</a>

      </div>

        <div class="summary-synopsis"><p>Builds a query to retrieve projects associated with a user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#provision_sandbox/3" data-no-tooltip="" translate="no">provision_sandbox(parent, actor, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a new sandbox project by cloning from a parent project.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#root_of/1" data-no-tooltip="" translate="no">root_of(p)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the <strong>root ancestor</strong> of a project by walking up <code class="inline">parent_id</code> links.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#sandbox_name_exists?/3" data-no-tooltip="" translate="no">sandbox_name_exists?(parent_id, name, excluding_id \\ nil)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if a sandbox with the given name exists under the parent project.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#save_dataclips?/1" data-no-tooltip="" translate="no">save_dataclips?(id)</a>

      </div>

        <div class="summary-synopsis"><p>Should input or output dataclips be saved for runs in this project?</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#schedule_project_deletion/1" data-no-tooltip="" translate="no">schedule_project_deletion(project)</a>

      </div>

        <div class="summary-synopsis"><p>Given a project, this function sets a scheduled deletion
date based on the PURGE_DELETED_AFTER_DAYS environment variable. If no ENV is
set, this date defaults to NOW but the automatic project purge cronjob will
never run. (Note that subsequent logins will be blocked for projects pending
deletion.)</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#scheduled_project_deletion_changes/2" data-no-tooltip="" translate="no">scheduled_project_deletion_changes(multi, list)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#select_first_project_for_user/1" data-no-tooltip="" translate="no">select_first_project_for_user(user)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#subscribe/0" data-no-tooltip="" translate="no">subscribe()</a>

      </div>

        <div class="summary-synopsis"><p>See <a><code class="inline">Lightning.Projects.Events.subscribe/0</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_project/3" data-no-tooltip="" translate="no">update_project(project, attrs, user \\ nil)</a>

      </div>

        <div class="summary-synopsis"><p>Updates a project.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_project_user/2" data-no-tooltip="" translate="no">update_project_user(project_user, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Updates a project user.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_project_with_users/3" data-no-tooltip="" translate="no">update_project_with_users(project, attrs, notify_users \\ true)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_sandbox/3" data-no-tooltip="" translate="no">update_sandbox(sandbox, actor, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Updates a sandbox project's basic attributes (name, color, env).</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#validate_for_deletion/2" data-no-tooltip="" translate="no">validate_for_deletion(project, attrs)</a>

      </div>

        <div class="summary-synopsis"><p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the project scheduled_deletion.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>

    <div class="functions-list">
<section class="detail" id="add_project_users/3">

    <span id="add_project_users/2"></span>

  <div class="detail-header">
    <a href="#add_project_users/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">add_project_users(project, project_users, notify_users \\ true)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L532" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> add_project_users(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>(), ...], <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()) ::
  {:ok, [<a href="Lightning.Projects.ProjectUser.html#t:t/0">Lightning.Projects.ProjectUser.t</a>(), ...]}
  | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>


  </section>
</section>
<section class="detail" id="append_project_head/2">

  <div class="detail-header">
    <a href="#append_project_head/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">append_project_head(project, hash)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1514" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> append_project_head(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) ::
  {:ok, <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()} | {:error, :bad_hash}</pre>

      </div>

<p>Appends a new 12-hex head hash to <code class="inline">project.version_history</code> (append-only).</p><p>This is a lenient wrapper that validates using
<code class="inline">Lightning.Validators.Hex.valid?(hash)</code> and returns tagged tuples.
For atomic locking and errors by exception, use <a href="#append_project_head!/2"><code class="inline">append_project_head!/2</code></a>.</p><h2 id="append_project_head/2-validation" class="section-heading"><a href="#append_project_head/2-validation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Validation</span></h2><ul><li><code class="inline">hash</code> must be <strong>12 lowercase hex characters</strong> (<code class="inline">0-9</code>, <code class="inline">a-f</code>).</li><li>No duplicates: if the hash already exists in the array, this is a no-op.</li></ul><h2 id="append_project_head/2-concurrency" class="section-heading"><a href="#append_project_head/2-concurrency" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Concurrency</span></h2><p>The underlying <code class="inline">!/2</code> variant locks the row (<code class="inline">FOR UPDATE</code>) to avoid lost updates.</p>
  </section>
</section>
<section class="detail" id="append_project_head!/2">

  <div class="detail-header">
    <a href="#append_project_head!/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">append_project_head!(project, hash)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1534" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> append_project_head!(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) ::
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()</pre>

      </div>

<p>Like <a href="#append_project_head/2"><code class="inline">append_project_head/2</code></a>, but raises on invalid input and performs the
append within a transaction that locks the project row.</p><h2 id="append_project_head!/2-behavior" class="section-heading"><a href="#append_project_head!/2-behavior" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Behavior</span></h2><ul><li>Raises <a href="https://hexdocs.pm/elixir/ArgumentError.html"><code class="inline">ArgumentError</code></a> if <code class="inline">hash</code> is not <strong>12 lowercase hex</strong>.</li><li>Uses <code class="inline">SELECT … FOR UPDATE</code> to read the current array, appends if missing,
and writes back in the same transaction.</li><li>Idempotent: if the hash is already present, returns the unchanged project.</li></ul>
  </section>
</section>
<section class="detail" id="cancel_scheduled_deletion/1">

  <div class="detail-header">
    <a href="#cancel_scheduled_deletion/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">cancel_scheduled_deletion(project_id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L954" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="change_project/2">

    <span id="change_project/1"></span>

  <div class="detail-header">
    <a href="#change_project/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">change_project(project, attrs \\ %{})</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L713" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for tracking project changes.</p><h2 id="change_project/2-examples" class="section-heading"><a href="#change_project/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">change_project</span><span class="p" data-group-id="5908948296-1">(</span><span class="n">project</span><span class="p" data-group-id="5908948296-1">)</span><span class="w">
</span><span class="p" data-group-id="5908948296-2">%</span><span class="nc" data-group-id="5908948296-2">Ecto.Changeset</span><span class="p" data-group-id="5908948296-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5908948296-3">%</span><span class="nc" data-group-id="5908948296-3">Project</span><span class="p" data-group-id="5908948296-3">{</span><span class="p" data-group-id="5908948296-3">}</span><span class="p" data-group-id="5908948296-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="compute_project_head_hash/1">

  <div class="detail-header">
    <a href="#compute_project_head_hash/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">compute_project_head_hash(project_id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1477" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Computes a deterministic 12-hex “project head” hash from the <em>latest</em> version
hash per workflow.</p><p>The algorithm:</p><ol><li>For each workflow in the project, select the most recent row in <code class="inline">workflow_versions</code>
by <code class="inline">(inserted_at DESC, id DESC)</code>.</li><li>Build pairs <code class="inline">[[workflow_id_as_string, hash], ...]</code>.</li><li>JSON-encode the pairs and take <code class="inline">sha256</code> of the bytes.</li><li>Return the first 12 lowercase hex chars.</li></ol><h2 id="compute_project_head_hash/1-guarantees" class="section-heading"><a href="#compute_project_head_hash/1-guarantees" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Guarantees</span></h2><ul><li><strong>Deterministic</strong> for a given set of latest heads.</li><li>If a project has no workflow versions, returns the digest of <code class="inline">[]</code>, i.e. a stable
12-hex string representing “empty”.</li></ul><h2 id="compute_project_head_hash/1-use-cases" class="section-heading"><a href="#compute_project_head_hash/1-use-cases" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Use cases</span></h2><ul><li>Change detection across environments.</li><li>Cache keys and optimistic comparisons (e.g. “is this workspace up-to-date?”).</li></ul>
  </section>
</section>
<section class="detail" id="create_project/2">

    <span id="create_project/0"></span>

    <span id="create_project/1"></span>

  <div class="detail-header">
    <a href="#create_project/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">create_project(attrs \\ %{}, schedule_email? \\ true)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L404" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Creates a project.</p><h2 id="create_project/2-examples" class="section-heading"><a href="#create_project/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">create_project</span><span class="p" data-group-id="3506044043-1">(</span><span class="p" data-group-id="3506044043-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="3506044043-2">}</span><span class="p" data-group-id="3506044043-1">)</span><span class="w">
</span><span class="p" data-group-id="3506044043-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3506044043-4">%</span><span class="nc" data-group-id="3506044043-4">Project</span><span class="p" data-group-id="3506044043-4">{</span><span class="p" data-group-id="3506044043-4">}</span><span class="p" data-group-id="3506044043-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">create_project</span><span class="p" data-group-id="3506044043-5">(</span><span class="p" data-group-id="3506044043-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="3506044043-6">}</span><span class="p" data-group-id="3506044043-5">)</span><span class="w">
</span><span class="p" data-group-id="3506044043-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3506044043-8">%</span><span class="nc" data-group-id="3506044043-8">Ecto.Changeset</span><span class="p" data-group-id="3506044043-8">{</span><span class="p" data-group-id="3506044043-8">}</span><span class="p" data-group-id="3506044043-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="create_sandbox/3">

    <span id="create_sandbox/2"></span>

  <div class="detail-header">
    <a href="#create_sandbox/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">create_sandbox(project, attrs, schedule_email? \\ false)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1360" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> create_sandbox(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()) ::
  {:ok, <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Creates a sandbox under the given <code class="inline">parent</code> by delegating to <a href="#create_project/2"><code class="inline">create_project/2</code></a>.</p><p>This is a convenience wrapper that sets <code class="inline">:parent_id</code> and preserves the
existing behavior around collaborator emails (off by default unless <code class="inline">schedule_email?</code> is <code class="inline">true</code>).</p><h2 id="create_sandbox/3-notes" class="section-heading"><a href="#create_sandbox/3-notes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Notes</span></h2><ul><li>Child names are scoped-unique by <code class="inline">(parent_id, name)</code>. Root names may repeat,
but two siblings cannot share a name (enforced by the <code class="inline">projects_unique_child_name</code> index).</li><li>This function does <strong>not</strong> clone workflows, credentials, or dataclips. It only creates
a new project row with <code class="inline">parent_id</code> set. See sandbox provisioning flow for full cloning.</li></ul><h2 id="create_sandbox/3-returns" class="section-heading"><a href="#create_sandbox/3-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li><code class="inline">{:ok, %Project{}}</code> on success</li><li><code class="inline">{:error, %Ecto.Changeset{}}</code> on validation/unique errors</li></ul>
  </section>
</section>
<section class="detail" id="delete_project/1">

  <div class="detail-header">
    <a href="#delete_project/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_project(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L608" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Deletes a project and its related data, including workflows, work orders,
steps, jobs, runs, triggers, project users, project credentials, and dataclips</p><h2 id="delete_project/1-examples" class="section-heading"><a href="#delete_project/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">delete_project</span><span class="p" data-group-id="2513379478-1">(</span><span class="n">project</span><span class="p" data-group-id="2513379478-1">)</span><span class="w">
</span><span class="p" data-group-id="2513379478-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2513379478-3">%</span><span class="nc" data-group-id="2513379478-3">Project</span><span class="p" data-group-id="2513379478-3">{</span><span class="p" data-group-id="2513379478-3">}</span><span class="p" data-group-id="2513379478-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">delete_project</span><span class="p" data-group-id="2513379478-4">(</span><span class="n">project</span><span class="p" data-group-id="2513379478-4">)</span><span class="w">
</span><span class="p" data-group-id="2513379478-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2513379478-6">%</span><span class="nc" data-group-id="2513379478-6">Ecto.Changeset</span><span class="p" data-group-id="2513379478-6">{</span><span class="p" data-group-id="2513379478-6">}</span><span class="p" data-group-id="2513379478-5">}</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_project_async/1">

  <div class="detail-header">
    <a href="#delete_project_async/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_project_async(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L629" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_project_async(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()) :: {:ok, <a href="https://hexdocs.pm/oban/2.20.1/Oban.Job.html#t:t/0">Oban.Job.t</a>()}</pre>

      </div>


  </section>
</section>
<section class="detail" id="delete_project_dataclips/2">

    <span id="delete_project_dataclips/1"></span>

  <div class="detail-header">
    <a href="#delete_project_dataclips/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_project_dataclips(project, batch_size \\ 1000)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L935" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_project_dataclips(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">non_neg_integer</a>()) ::
  :ok</pre>

      </div>

<p>Deletes project dataclips in batches</p>
  </section>
</section>
<section class="detail" id="delete_project_user!/1">

  <div class="detail-header">
    <a href="#delete_project_user!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_project_user!(project_user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L573" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_project_user!(<a href="Lightning.Projects.ProjectUser.html#t:t/0">Lightning.Projects.ProjectUser.t</a>()) ::
  <a href="Lightning.Projects.ProjectUser.html#t:t/0">Lightning.Projects.ProjectUser.t</a>()</pre>

      </div>

<p>Deletes a project user and removes their credentials from the project.</p><p>This function:</p><ol><li>Deletes the association between the user and the project</li><li>Removes any credentials owned by the user from the project</li></ol><p>All operations are performed within a transaction for data consistency.</p><h2 id="delete_project_user!/1-parameters" class="section-heading"><a href="#delete_project_user!/1-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">project_user</code>: The <code class="inline">ProjectUser</code> struct to be deleted</li></ul><h2 id="delete_project_user!/1-returns" class="section-heading"><a href="#delete_project_user!/1-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li>The deleted <code class="inline">ProjectUser</code> struct</li></ul>
  </section>
</section>
<section class="detail" id="delete_project_workorders/2">

    <span id="delete_project_workorders/1"></span>

  <div class="detail-header">
    <a href="#delete_project_workorders/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_project_workorders(project, batch_size \\ 1000)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L924" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_project_workorders(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">non_neg_integer</a>()) ::
  :ok</pre>

      </div>

<p>Deletes project work orders in batches</p>
  </section>
</section>
<section class="detail" id="delete_sandbox/2">

  <div class="detail-header">
    <a href="#delete_sandbox/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">delete_sandbox(sandbox, actor)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1619" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_sandbox(
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>() | <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>(),
  <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()
) ::
  {:ok, <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()}
  | {:error, :unauthorized | :not_found | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}</pre>

      </div>

<p>Deletes a sandbox and all its descendant projects.</p><p><strong>Warning</strong>: Permanently removes the sandbox and any nested sandboxes.</p><h2 id="delete_sandbox/2-parameters" class="section-heading"><a href="#delete_sandbox/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">sandbox</code> - Sandbox to delete (project struct or ID string)</li><li><code class="inline">actor</code> - User performing deletion (needs <code class="inline">:owner</code> or <code class="inline">:admin</code> role on sandbox)</li></ul><h2 id="delete_sandbox/2-returns" class="section-heading"><a href="#delete_sandbox/2-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li><code class="inline">{:ok, deleted_sandbox}</code> - Successfully deleted</li><li><code class="inline">{:error, :unauthorized}</code> - Actor lacks permission</li><li><code class="inline">{:error, :not_found}</code> - Sandbox not found</li></ul>
  </section>
</section>
<section class="detail" id="descendant_of?/3">

    <span id="descendant_of?/2"></span>

  <div class="detail-header">
    <a href="#descendant_of?/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">descendant_of?(child_project, parent_project, root_project \\ nil)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L278" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> descendant_of?(
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>() | nil
) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()</pre>

      </div>

<p>Returns true if <code class="inline">child_project</code> is a descendant of <code class="inline">parent_project</code>.</p><p>Walks up the parent chain using preloaded <code class="inline">:parent</code> associations to determine
if <code class="inline">child_project</code> has <code class="inline">parent_project</code> anywhere in its ancestry.</p><h2 id="descendant_of?/3-parameters" class="section-heading"><a href="#descendant_of?/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">child_project</code>: The project to check (must have <code class="inline">:parent</code> preloaded)</li><li><code class="inline">parent_project</code>: The potential parent/ancestor project</li><li><code class="inline">root_project</code>: Optional root project to use as stopping condition</li></ul><h2 id="descendant_of?/3-examples" class="section-heading"><a href="#descendant_of?/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Projects</span><span class="o">.</span><span class="n">descendant_of?</span><span class="p" data-group-id="2642100027-1">(</span><span class="n">sandbox</span><span class="p">,</span><span class="w"> </span><span class="n">parent_project</span><span class="p" data-group-id="2642100027-1">)</span><span class="w">
</span><span class="no">true</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Projects</span><span class="o">.</span><span class="n">descendant_of?</span><span class="p" data-group-id="2642100027-2">(</span><span class="n">sibling</span><span class="p">,</span><span class="w"> </span><span class="n">parent_project</span><span class="p" data-group-id="2642100027-2">)</span><span class="w">
</span><span class="no">false</span></code></pre>
  </section>
</section>
<section class="detail" id="export_project/3">

    <span id="export_project/2"></span>

  <div class="detail-header">
    <a href="#export_project/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">export_project(atom, project_id, snapshot_ids \\ nil)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L854" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> export_project(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>(), [<a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()] | nil) :: {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()}</pre>

      </div>

<p>Exports a project as yaml.</p><h2 id="export_project/3-examples" class="section-heading"><a href="#export_project/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">export_project</span><span class="p" data-group-id="0907040582-1">(</span><span class="ss">:yaml</span><span class="p">,</span><span class="w"> </span><span class="n">project_id</span><span class="p" data-group-id="0907040582-1">)</span><span class="w">
</span><span class="p" data-group-id="0907040582-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p" data-group-id="0907040582-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="find_users_to_notify_of_trigger_failure/1">

  <div class="detail-header">
    <a href="#find_users_to_notify_of_trigger_failure/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">find_users_to_notify_of_trigger_failure(project_id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1289" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="get_project/1">

  <div class="detail-header">
    <a href="#get_project/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L218" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_project(<a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>() | nil</pre>

      </div>

<p>Fetches a project by id (root <strong>or</strong> sandbox) and preloads its direct <code class="inline">:parent</code>.</p><p>Returns <code class="inline">nil</code> if no project with the given id exists.</p>
  </section>
</section>
<section class="detail" id="get_project!/1">

  <div class="detail-header">
    <a href="#get_project!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project!(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L210" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_project!(<a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()</pre>

      </div>

<p>Fetches a project by id (root <strong>or</strong> sandbox) and preloads its direct <code class="inline">:parent</code>.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no project with the given id exists.</p>
  </section>
</section>
<section class="detail" id="get_project_credential/2">

  <div class="detail-header">
    <a href="#get_project_credential/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_credential(project_id, credential_id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L834" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="get_project_for_run/1">

  <div class="detail-header">
    <a href="#get_project_for_run/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_for_run(run)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L240" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_project_for_run(<a href="Lightning.Run.html#t:t/0">Lightning.Run.t</a>()) :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>() | nil</pre>

      </div>

<p>Gets the project associated with a run.
Traverses Run → WorkOrder → Workflow → Project.</p><p>Returns nil if the run is not associated with a project.</p><h2 id="get_project_for_run/1-examples" class="section-heading"><a href="#get_project_for_run/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_project_for_run</span><span class="p" data-group-id="1216877095-1">(</span><span class="n">run</span><span class="p" data-group-id="1216877095-1">)</span><span class="w">
</span><span class="p" data-group-id="1216877095-2">%</span><span class="nc" data-group-id="1216877095-2">Project</span><span class="p" data-group-id="1216877095-2">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;production&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="1216877095-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_project_for_run</span><span class="p" data-group-id="1216877095-3">(</span><span class="n">orphaned_run</span><span class="p" data-group-id="1216877095-3">)</span><span class="w">
</span><span class="no">nil</span></code></pre>
  </section>
</section>
<section class="detail" id="get_project_user/1">

  <div class="detail-header">
    <a href="#get_project_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_user(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L326" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_project_user(<a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: <a href="Lightning.Projects.ProjectUser.html#t:t/0">Lightning.Projects.ProjectUser.t</a>() | nil</pre>

      </div>


  </section>
</section>
<section class="detail" id="get_project_user/2">

  <div class="detail-header">
    <a href="#get_project_user/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_user(project_id, user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L330" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_project_user(
  project :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  user :: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()
) ::
  <a href="Lightning.Projects.ProjectUser.html#t:t/0">Lightning.Projects.ProjectUser.t</a>() | nil</pre>

          <pre translate="no"><span class="attribute">@spec</span> get_project_user(project_id :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>(), user :: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  <a href="Lightning.Projects.ProjectUser.html#t:t/0">Lightning.Projects.ProjectUser.t</a>() | nil</pre>

      </div>


  </section>
</section>
<section class="detail" id="get_project_user!/1">

  <div class="detail-header">
    <a href="#get_project_user!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_user!(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L323" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a single project_user.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if the ProjectUser does not exist.</p><h2 id="get_project_user!/1-examples" class="section-heading"><a href="#get_project_user!/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_project_user!</span><span class="p" data-group-id="4550689191-1">(</span><span class="mi">123</span><span class="p" data-group-id="4550689191-1">)</span><span class="w">
</span><span class="p" data-group-id="4550689191-2">%</span><span class="nc" data-group-id="4550689191-2">ProjectUser</span><span class="p" data-group-id="4550689191-2">{</span><span class="p" data-group-id="4550689191-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_project_user!</span><span class="p" data-group-id="4550689191-3">(</span><span class="mi">456</span><span class="p" data-group-id="4550689191-3">)</span><span class="w">
</span><span class="gt">** (Ecto.NoResultsError)</span></code></pre>
  </section>
</section>
<section class="detail" id="get_project_user_role/2">

  <div class="detail-header">
    <a href="#get_project_user_role/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_user_role(user, project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L806" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_project_user_role(
  user :: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(),
  project :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()
) :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | nil</pre>

      </div>

<p>Returns the role of a user in a project.
Possible roles are :admin, :viewer, :editor, and :owner</p><h2 id="get_project_user_role/2-examples" class="section-heading"><a href="#get_project_user_role/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_project_user_role</span><span class="p" data-group-id="9225066313-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="p" data-group-id="9225066313-1">)</span><span class="w">
</span><span class="ss">:admin</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_project_user_role</span><span class="p" data-group-id="9225066313-2">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="p" data-group-id="9225066313-2">)</span><span class="w">
</span><span class="ss">:viewer</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_project_user_role</span><span class="p" data-group-id="9225066313-3">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="p" data-group-id="9225066313-3">)</span><span class="w">
</span><span class="ss">:editor</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_project_user_role</span><span class="p" data-group-id="9225066313-4">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="p" data-group-id="9225066313-4">)</span><span class="w">
</span><span class="ss">:owner</span></code></pre>
  </section>
</section>
<section class="detail" id="get_project_users!/1">

  <div class="detail-header">
    <a href="#get_project_users!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_users!(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L369" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Get all project users for a given project</p>
  </section>
</section>
<section class="detail" id="get_project_with_users!/1">

  <div class="detail-header">
    <a href="#get_project_with_users!/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_project_with_users!(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L361" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Gets a single project with it's members via <code class="inline">project_users</code>.</p><p>Raises <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if the Project does not exist.</p><h2 id="get_project_with_users!/1-examples" class="section-heading"><a href="#get_project_with_users!/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">get_project!</span><span class="p" data-group-id="6821275942-1">(</span><span class="mi">123</span><span class="p" data-group-id="6821275942-1">)</span><span class="w">
</span><span class="p" data-group-id="6821275942-2">%</span><span class="nc" data-group-id="6821275942-2">Project</span><span class="p" data-group-id="6821275942-2">{</span><span class="p" data-group-id="6821275942-2">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">get_project!</span><span class="p" data-group-id="6821275942-3">(</span><span class="mi">456</span><span class="p" data-group-id="6821275942-3">)</span><span class="w">
</span><span class="gt">** (Ecto.NoResultsError)</span></code></pre>
  </section>
</section>
<section class="detail" id="get_projects_for_user/1">

  <div class="detail-header">
    <a href="#get_projects_for_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_projects_for_user(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L759" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_projects_for_user(user :: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) :: [
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()
]</pre>

      </div>

<p>Fetches projects for a given user from the database.</p><h2 id="get_projects_for_user/1-parameters" class="section-heading"><a href="#get_projects_for_user/1-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li>user: The user struct for which projects are being queried.</li><li>opts: Keyword list of options including :include for associations to preload and :order_by for sorting.</li></ul><h2 id="get_projects_for_user/1-returns" class="section-heading"><a href="#get_projects_for_user/1-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li>A list of projects associated with the user.</li></ul>
  </section>
</section>
<section class="detail" id="get_projects_overview/2">

    <span id="get_projects_overview/1"></span>

  <div class="detail-header">
    <a href="#get_projects_overview/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_projects_overview(user, opts \\ [])</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L58" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="invite_collaborators/3">

  <div class="detail-header">
    <a href="#invite_collaborators/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">invite_collaborators(project, collaborators, inviter)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1164" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="list_project_admin_emails/1">

  <div class="detail-header">
    <a href="#list_project_admin_emails/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_project_admin_emails(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L383" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_project_admin_emails(<a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: [<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), ...] | []</pre>

      </div>

<p>Lists emails of users with <code class="inline">:owner</code> or <code class="inline">:admin</code> roles in the project</p>
  </section>
</section>
<section class="detail" id="list_project_credentials/1">

  <div class="detail-header">
    <a href="#list_project_credentials/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_project_credentials(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L720" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_project_credentials(project :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()) :: [
  <a href="Lightning.Projects.ProjectCredential.html#t:t/0">Lightning.Projects.ProjectCredential.t</a>()
]</pre>

      </div>


  </section>
</section>
<section class="detail" id="list_project_files/2">

    <span id="list_project_files/1"></span>

  <div class="detail-header">
    <a href="#list_project_files/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_project_files(project, opts \\ [])</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1278" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="list_projects/0">

  <div class="detail-header">
    <a href="#list_projects/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_projects()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L192" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns the list of projects.</p><h2 id="list_projects/0-examples" class="section-heading"><a href="#list_projects/0-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">list_projects</span><span class="p" data-group-id="4343492466-1">(</span><span class="p" data-group-id="4343492466-1">)</span><span class="w">
</span><span class="p" data-group-id="4343492466-2">[</span><span class="p" data-group-id="4343492466-3">%</span><span class="nc" data-group-id="4343492466-3">Project</span><span class="p" data-group-id="4343492466-3">{</span><span class="p" data-group-id="4343492466-3">}</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="4343492466-2">]</span></code></pre>
  </section>
</section>
<section class="detail" id="list_projects_having_history_retention/0">

  <div class="detail-header">
    <a href="#list_projects_having_history_retention/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_projects_having_history_retention()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L200" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_projects_having_history_retention() ::
  [] | [<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), ...]</pre>

      </div>

<p>Lists all projects that have history retention</p>
  </section>
</section>
<section class="detail" id="list_sandboxes/1">

  <div class="detail-header">
    <a href="#list_sandboxes/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_sandboxes(parent_id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1307" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_sandboxes(<a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>()) :: [<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()]</pre>

      </div>

<p>Returns the <em>direct</em> sandboxes (children) of a parent project, ordered by <code class="inline">name</code> (ASC).</p><p>This is a flat view: only rows where <code class="inline">parent.id == child.parent_id</code> are returned.
If we later support arbitrarily deep nesting, switch this to a recursive CTE.</p>
  </section>
</section>
<section class="detail" id="list_workflows/1">

  <div class="detail-header">
    <a href="#list_workflows/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_workflows(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L678" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="list_workspace_projects/2">

    <span id="list_workspace_projects/1"></span>

  <div class="detail-header">
    <a href="#list_workspace_projects/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">list_workspace_projects(project_id_or_struct, opts \\ [])</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1385" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> list_workspace_projects(
  <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">keyword</a>()
) :: %{
  root: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  descendants: [<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()]
}</pre>

          <pre translate="no"><span class="attribute">@spec</span> list_workspace_projects(
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">keyword</a>()
) :: %{
  root: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  descendants: [<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()]
}</pre>

      </div>

<p>Returns all projects in a workspace hierarchy.</p><p>Returns a map with the root project and all its descendant sandboxes at any depth level.
Uses a recursive CTE to traverse the entire project tree from root to leaves.
Descendants are sorted as a flat list according to the specified options.</p><h2 id="list_workspace_projects/2-options" class="section-heading"><a href="#list_workspace_projects/2-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Options</span></h2><ul><li><code class="inline">sort_by</code>: Field to sort by (<code class="inline">:name</code>, <code class="inline">:inserted_at</code>, <code class="inline">:updated_at</code>). Defaults to <code class="inline">:name</code>.</li><li><code class="inline">sort_order</code>: Sort direction (<code class="inline">:asc</code> or <code class="inline">:desc</code>). Defaults to <code class="inline">:asc</code>.</li></ul><h2 id="list_workspace_projects/2-examples" class="section-heading"><a href="#list_workspace_projects/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># Default sorting (name ascending)</span><span class="w">
</span><span class="nc">Projects</span><span class="o">.</span><span class="n">list_workspace_projects</span><span class="p" data-group-id="7876634639-1">(</span><span class="n">project_id</span><span class="p" data-group-id="7876634639-1">)</span><span class="w">

</span><span class="c1"># Sort by name descending</span><span class="w">
</span><span class="nc">Projects</span><span class="o">.</span><span class="n">list_workspace_projects</span><span class="p" data-group-id="7876634639-2">(</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="ss">sort_by</span><span class="p">:</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">sort_order</span><span class="p">:</span><span class="w"> </span><span class="ss">:desc</span><span class="p" data-group-id="7876634639-2">)</span><span class="w">

</span><span class="c1"># Sort by creation date</span><span class="w">
</span><span class="nc">Projects</span><span class="o">.</span><span class="n">list_workspace_projects</span><span class="p" data-group-id="7876634639-3">(</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="ss">sort_by</span><span class="p">:</span><span class="w"> </span><span class="ss">:inserted_at</span><span class="p">,</span><span class="w"> </span><span class="ss">sort_order</span><span class="p">:</span><span class="w"> </span><span class="ss">:desc</span><span class="p" data-group-id="7876634639-3">)</span></code></pre>
  </section>
</section>
<section class="detail" id="member_of?/2">

  <div class="detail-header">
    <a href="#member_of?/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">member_of?(project, user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L821" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="perform/1">

  <div class="detail-header">
    <a href="#perform/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">perform(job)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L137" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Perform, when called with %{&quot;type&quot; =&gt; &quot;purge_deleted&quot;}
will find projects that are ready for permanent deletion and purge them.</p>
  </section>
</section>
<section class="detail" id="project_credentials_query/1">

  <div class="detail-header">
    <a href="#project_credentials_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_credentials_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L689" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_dataclips_query/1">

  <div class="detail-header">
    <a href="#project_dataclips_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_dataclips_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L693" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_jobs_query/1">

  <div class="detail-header">
    <a href="#project_jobs_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_jobs_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L659" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_run_step_query/1">

  <div class="detail-header">
    <a href="#project_run_step_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_run_step_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L643" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_runs_query/1">

  <div class="detail-header">
    <a href="#project_runs_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_runs_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L635" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_steps_query/1">

  <div class="detail-header">
    <a href="#project_steps_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_steps_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L666" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_triggers_query/1">

  <div class="detail-header">
    <a href="#project_triggers_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_triggers_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L697" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_users_query/1">

  <div class="detail-header">
    <a href="#project_users_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_users_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L685" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> project_users_query(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | %{:id =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>(), optional(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}) ::
  <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Query.html#t:t/0">Ecto.Query.t</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="project_workflows_query/1">

  <div class="detail-header">
    <a href="#project_workflows_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_workflows_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L674" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="project_workorders_query/1">

  <div class="detail-header">
    <a href="#project_workorders_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">project_workorders_query(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L652" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="projects_for_user_query/1">

  <div class="detail-header">
    <a href="#projects_for_user_query/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">projects_for_user_query(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L737" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> projects_for_user_query(user :: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Queryable.html#t:t/0">Ecto.Queryable.t</a>()</pre>

      </div>

<p>Builds a query to retrieve projects associated with a user.</p><h2 id="projects_for_user_query/1-parameters" class="section-heading"><a href="#projects_for_user_query/1-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li>user: The user struct for which projects are being queried.</li><li>opts: Keyword list of options including :include for associations to preload and :order_by for sorting.</li></ul><h2 id="projects_for_user_query/1-returns" class="section-heading"><a href="#projects_for_user_query/1-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li>An Ecto queryable struct to fetch projects.</li></ul>
  </section>
</section>
<section class="detail" id="provision_sandbox/3">

  <div class="detail-header">
    <a href="#provision_sandbox/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">provision_sandbox(parent, actor, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1578" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> provision_sandbox(
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(),
  <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(),
  <a href="Lightning.Projects.Sandboxes.html#t:provision_attrs/0">Lightning.Projects.Sandboxes.provision_attrs</a>()
) :: {:ok, <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()} | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()}</pre>

      </div>

<p>Creates a new sandbox project by cloning from a parent project.</p><h2 id="provision_sandbox/3-parameters" class="section-heading"><a href="#provision_sandbox/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">parent</code> - Project to clone from</li><li><code class="inline">actor</code> - User creating the sandbox (needs <code class="inline">:owner</code> or <code class="inline">:admin</code> role on parent)</li><li><code class="inline">attrs</code> - Creation attributes (name, color, env, collaborators, dataclip_ids)</li></ul><h2 id="provision_sandbox/3-returns" class="section-heading"><a href="#provision_sandbox/3-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li><code class="inline">{:ok, sandbox_project}</code> - Successfully created sandbox</li><li><code class="inline">{:error, :unauthorized}</code> - Actor lacks permission on parent</li><li><code class="inline">{:error, changeset}</code> - Validation or database error</li></ul><p>See <a href="Lightning.Projects.Sandboxes.html#provision/3"><code class="inline">Lightning.Projects.Sandboxes.provision/3</code></a> for detailed behavior.</p>
  </section>
</section>
<section class="detail" id="root_of/1">

  <div class="detail-header">
    <a href="#root_of/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">root_of(p)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L251" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> root_of(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()) :: <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()</pre>

      </div>

<p>Returns the <strong>root ancestor</strong> of a project by walking up <code class="inline">parent_id</code> links.</p><p>Supports arbitrarily deep nesting. (Assumes the parent chain is well-formed.)</p>
  </section>
</section>
<section class="detail" id="sandbox_name_exists?/3">

    <span id="sandbox_name_exists?/2"></span>

  <div class="detail-header">
    <a href="#sandbox_name_exists?/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">sandbox_name_exists?(parent_id, name, excluding_id \\ nil)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1322" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Checks if a sandbox with the given name exists under the parent project.</p><p>Returns <code class="inline">true</code> if a sandbox exists, <code class="inline">false</code> otherwise.
Optionally excludes a specific sandbox by ID (useful for edit operations).</p>
  </section>
</section>
<section class="detail" id="save_dataclips?/1">

  <div class="detail-header">
    <a href="#save_dataclips?/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">save_dataclips?(id)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L296" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Should input or output dataclips be saved for runs in this project?</p>
  </section>
</section>
<section class="detail" id="schedule_project_deletion/1">

  <div class="detail-header">
    <a href="#schedule_project_deletion/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">schedule_project_deletion(project)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L870" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Given a project, this function sets a scheduled deletion
date based on the PURGE_DELETED_AFTER_DAYS environment variable. If no ENV is
set, this date defaults to NOW but the automatic project purge cronjob will
never run. (Note that subsequent logins will be blocked for projects pending
deletion.)</p>
  </section>
</section>
<section class="detail" id="scheduled_project_deletion_changes/2">

  <div class="detail-header">
    <a href="#scheduled_project_deletion_changes/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">scheduled_project_deletion_changes(multi, list)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L880" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="select_first_project_for_user/1">

  <div class="detail-header">
    <a href="#select_first_project_for_user/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">select_first_project_for_user(user)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L812" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> select_first_project_for_user(user :: <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>()) ::
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>() | nil</pre>

      </div>


  </section>
</section>
<section class="detail" id="subscribe/0">

  <div class="detail-header">
    <a href="#subscribe/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">subscribe()</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L56" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>See <a href="Lightning.Projects.Events.html#subscribe/0"><code class="inline">Lightning.Projects.Events.subscribe/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="update_project/3">

    <span id="update_project/2"></span>

  <div class="detail-header">
    <a href="#update_project/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_project(project, attrs, user \\ nil)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L431" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Updates a project.</p><h2 id="update_project/3-examples" class="section-heading"><a href="#update_project/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">update_project</span><span class="p" data-group-id="1810547125-1">(</span><span class="n">project</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1810547125-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">new_value</span><span class="p" data-group-id="1810547125-2">}</span><span class="p" data-group-id="1810547125-1">)</span><span class="w">
</span><span class="p" data-group-id="1810547125-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1810547125-4">%</span><span class="nc" data-group-id="1810547125-4">Project</span><span class="p" data-group-id="1810547125-4">{</span><span class="p" data-group-id="1810547125-4">}</span><span class="p" data-group-id="1810547125-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">update_project</span><span class="p" data-group-id="1810547125-5">(</span><span class="n">project</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1810547125-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="1810547125-6">}</span><span class="p" data-group-id="1810547125-5">)</span><span class="w">
</span><span class="p" data-group-id="1810547125-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1810547125-8">%</span><span class="nc" data-group-id="1810547125-8">Ecto.Changeset</span><span class="p" data-group-id="1810547125-8">{</span><span class="p" data-group-id="1810547125-8">}</span><span class="p" data-group-id="1810547125-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="update_project_user/2">

  <div class="detail-header">
    <a href="#update_project_user/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_project_user(project_user, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L524" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Updates a project user.</p><h2 id="update_project_user/2-examples" class="section-heading"><a href="#update_project_user/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">update_project_user</span><span class="p" data-group-id="6678140921-1">(</span><span class="n">project_user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6678140921-2">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">new_value</span><span class="p" data-group-id="6678140921-2">}</span><span class="p" data-group-id="6678140921-1">)</span><span class="w">
</span><span class="p" data-group-id="6678140921-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6678140921-4">%</span><span class="nc" data-group-id="6678140921-4">ProjectUser</span><span class="p" data-group-id="6678140921-4">{</span><span class="p" data-group-id="6678140921-4">}</span><span class="p" data-group-id="6678140921-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">update_project_user</span><span class="p" data-group-id="6678140921-5">(</span><span class="n">projectUser</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6678140921-6">%{</span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="n">bad_value</span><span class="p" data-group-id="6678140921-6">}</span><span class="p" data-group-id="6678140921-5">)</span><span class="w">
</span><span class="p" data-group-id="6678140921-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6678140921-8">%</span><span class="nc" data-group-id="6678140921-8">Ecto.Changeset</span><span class="p" data-group-id="6678140921-8">{</span><span class="p" data-group-id="6678140921-8">}</span><span class="p" data-group-id="6678140921-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="update_project_with_users/3">

    <span id="update_project_with_users/2"></span>

  <div class="detail-header">
    <a href="#update_project_with_users/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_project_with_users(project, attrs, notify_users \\ true)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L469" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update_project_with_users(<a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">boolean</a>()) ::
  {:ok, <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()} | {:error, <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>


  </section>
</section>
<section class="detail" id="update_sandbox/3">

  <div class="detail-header">
    <a href="#update_sandbox/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_sandbox(sandbox, actor, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L1599" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> update_sandbox(
  <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>() | <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.UUID.html#t:t/0">Ecto.UUID.t</a>(),
  <a href="Lightning.Accounts.User.html#t:t/0">Lightning.Accounts.User.t</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()
) ::
  {:ok, <a href="Lightning.Projects.Project.html#t:t/0">Lightning.Projects.Project.t</a>()}
  | {:error, :unauthorized | :not_found | <a href="https://hexdocs.pm/ecto/3.13.2/Ecto.Changeset.html#t:t/0">Ecto.Changeset.t</a>()}</pre>

      </div>

<p>Updates a sandbox project's basic attributes (name, color, env).</p><h2 id="update_sandbox/3-parameters" class="section-heading"><a href="#update_sandbox/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">sandbox</code> - Sandbox to update (project struct or ID string)</li><li><code class="inline">actor</code> - User performing update (needs <code class="inline">:owner</code> or <code class="inline">:admin</code> role on sandbox)</li><li><code class="inline">attrs</code> - Map with name, color, and/or env keys</li></ul><h2 id="update_sandbox/3-returns" class="section-heading"><a href="#update_sandbox/3-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li><code class="inline">{:ok, updated_sandbox}</code> - Successfully updated</li><li><code class="inline">{:error, :unauthorized}</code> - Actor lacks permission</li><li><code class="inline">{:error, :not_found}</code> - Sandbox not found</li><li><code class="inline">{:error, changeset}</code> - Validation error</li></ul>
  </section>
</section>
<section class="detail" id="validate_for_deletion/2">

  <div class="detail-header">
    <a href="#validate_for_deletion/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">validate_for_deletion(project, attrs)</h1>


        <a href="https://github.com/OpenFn/lightning/blob/main/lib/lightning/projects.ex#L950" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns an <code class="inline">%Ecto.Changeset{}</code> for changing the project scheduled_deletion.</p><h2 id="validate_for_deletion/2-examples" class="section-heading"><a href="#validate_for_deletion/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">validate_for_deletion</span><span class="p" data-group-id="7652841243-1">(</span><span class="n">project</span><span class="p" data-group-id="7652841243-1">)</span><span class="w">
</span><span class="p" data-group-id="7652841243-2">%</span><span class="nc" data-group-id="7652841243-2">Ecto.Changeset</span><span class="p" data-group-id="7652841243-2">{</span><span class="ss">data</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7652841243-3">%</span><span class="nc" data-group-id="7652841243-3">Project</span><span class="p" data-group-id="7652841243-3">{</span><span class="p" data-group-id="7652841243-3">}</span><span class="p" data-group-id="7652841243-2">}</span></code></pre>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Lightning.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.4) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
